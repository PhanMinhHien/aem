<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dynamic_Links_Generator_AEM</title>
        <style>
            .openTagging,
            .closeTagging {
                background-color: #007bff;
                padding: 15px;
                display: inline-block;
                color: #ffff;
                border-radius: 5px;
            }

            .taskSection .form-group {
                flex-direction: row;
                justify-content: space-between;
            }

            .check {
                margin-bottom: 20px;
            }

            .delete-btn {
                padding: 0;
            }

            .link-part {
                background-color: #007bff;
                padding: 10px;
                color: #fff;
                display: inline-block;
            }

            #applySearchButton,
            #addFragment {
                margin-top: 20px;
            }

            .container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                padding: 20px;
                background-color: #f0f8ff;
                box-sizing: border-box;
                height: 100%;
                width: 100%;
            }

            h2 {
                color: #003366;
                border-bottom: 3px solid #007bff;
                padding-bottom: 6px;
                margin-top: 40px;
            }

            button {
                padding: 10px 0.5vw;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

            #localLanguages:not(:empty) {
                margin-bottom: 20px;
            }

            #localLanguages {
                column-count: 5;
            }

            button:hover {
                background-color: #0056b3;
            }

            a {
                color: #007bff;
                text-decoration: none;
            }

            a:hover {
                text-decoration: underline;
            }

            a.previous {
                color: #05a769 !important;
            }

            a.active {
                color: red !important;
            }

            .form-group {
                margin-bottom: 20px;
                display: flex;
                flex-direction: column;
            }

            .form-group label {
                margin-bottom: 6px;
                font-weight: 600;
                color: #003366;
            }

            .form-group-1 input[type="text"],
            .form-group-1 input[type="number"],
            .form-group-1 input[type="email"],
            .form-group-1 select,
            .form-group-1 textarea {
                padding: 12px 14px;
                border: 1px solid #ccc;
                border-radius: 6px;
                font-size: 16px;
                background-color: #f9f9f9;
                transition: all 0.3s ease;
                width: 100%;
                box-sizing: border-box;
            }

            .form-group-1 input:focus,
            .form-group-1 select:focus,
            .form-group-1 textarea:focus {
                border-color: #007bff;
                background-color: #fff;
                outline: none;
            }

            .form-group input[type="text"],
            .form-group input[type="number"],
            .form-group input[type="email"],
            .form-group select,
            .form-group textarea {
                padding: 12px 14px;
                border: 1px solid #ccc;
                border-radius: 6px;
                font-size: 16px;
                background-color: #f9f9f9;
                transition: all 0.3s ease;
                width: 100%;
                box-sizing: border-box;
            }

            .form-group input:focus,
            .form-group select:focus,
            .form-group textarea:focus {
                border-color: #007bff;
                background-color: #fff;
                outline: none;
            }

            .form-group textarea {
                font-size: 11px;
            }

            .checkbox-group {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-top: 10px;
            }

            .checkbox-group input[type="checkbox"] {
                width: 20px;
                height: 20px;
                accent-color: #4caf50;
            }

            .radio-group {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                margin-top: 10px;
            }

            .radio-group label {
                font-weight: 500;
                color: #003366;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            textarea {
                resize: vertical;
                min-height: 100px;
            }

            .form-group button {
                width: fit-content;
                padding: 10px 20px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

            .form-group button:hover {
                background-color: #0056b3;
            }

            #links:not(:empty),
            #fragmentContainer:not(:empty) {
                background-color: #f9f9f9;
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 15px;
                word-wrap: break-word;
                margin-bottom: 50px;
            }

            #links:empty {
                background-color: #f9f9f9;
                border: 1px solid #ddd;
                border-radius: 5px;
                height: 90vh;
            }

            #links a,
            #fragmentContainer a {
                display: block;
                margin-bottom: 8px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background-color: #fff;
                font-family: Arial, sans-serif;
            }

            th {
                background-color: #007bff;
                color: white;
                padding: 12px 15px;
                text-align: left;
                font-weight: bold;
            }

            td {
                padding: 12px 15px;
                text-align: left;
                border: 1px solid #ddd;
                font-size: 14px;
            }

            tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            tr:hover {
                background-color: #f1f1f1;
            }

            .popup,
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                background-color: rgba(0, 0, 0, 0.4);
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }

            .modal-content {
                background-color: #fff;
                margin: 0;
                padding: 20px;
                border: 1px solid #888;
                width: 70%;
                max-width: 50%;
                max-height: 50%;
                overflow-x: auto;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .close-button {
                color: #aaa;
                font-size: 28px;
                font-weight: bold;
                position: absolute;
                top: 0;
                right: 15px;
                cursor: pointer;
            }

            .close-button:hover,
            .close-button:focus {
                color: black;
            }

            #floatingSavedBtn {
                position: fixed;
                top: 20px;
                left: 20px;
                width: 60px;
                height: 60px;
                background-color: #007bff;
                color: white;
                border-radius: 50%;
                text-align: center;
                line-height: 60px;
                font-size: 24px;
                cursor: pointer;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                transition: background-color 0.3s;
            }

            #floatingSavedBtn:hover {
                background-color: #0056b3;
            }

            .hidden {
                display: none;
            }

            textarea {
                resize: none;
            }

            #floatingMenu {
                position: fixed;
                top: 50%;
                left: 20px;
                transform: translateY(-50%);
                display: flex;
                flex-direction: column;
                gap: 12px;
                z-index: 9999;
            }

            .floating-btn {
                position: relative;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 25px;
                font-size: 16px;
                cursor: pointer;
                display: flex;
                align-items: center;
                padding: 10px;
                width: 44px;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .floating-btn .icon {
                width: 24px;
                text-align: center;
                flex-shrink: 0;
            }

            .floating-btn .btn-label {
                white-space: nowrap;
                opacity: 0;
                margin-left: 10px;
                transition: opacity 0.3s ease;
                pointer-events: none;
                color: white;
            }

            .floating-btn:hover {
                width: 15vw;
                max-width: 200px;
                background: #005bb5;
                border-radius: 25px;
            }

            .floating-btn:hover .btn-label {
                opacity: 1;
            }

            .floating-btn.active {
                background-color: #ffffff;
                color: #007bff;
                box-shadow: 0 0 8px #007bff;
            }

            .floating-btn.active .btn-label {
                color: #007bff;
            }

            .floating-btn.active:hover {
                background-color: #ffffff;
            }

            #floatingPanels {
                position: fixed;
                top: 50%;
                left: 80px;
                transform: translateY(-50%);
                display: flex;
                flex-direction: column;
                gap: 12px;
                z-index: 9998;
            }

            .floating-panel {
                display: none;
                background: #fff;
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 20px;
                width: 680px;
                /* max-height: 70vh;
                overflow-y: auto; */
                animation: fadeIn 0.3s ease-in-out;
            }

            .floating-panel.show {
                display: block;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .column-right {
                margin-left: calc(730px + 60px);
                width: 100%;
            }

            #floatingMenuContainer {
                max-height: 94vh;
                overflow-y: auto;
                scrollbar-width: none;
                /* Scrollbar styles */
                scrollbar-width: thin;
                /* Firefox */
                scrollbar-color: #007bff transparent;
                /* Firefox */
            }

            /* Chrome, Edge, Safari */
            #floatingMenuContainer::-webkit-scrollbar {
                width: 4px;
            }

            #floatingMenuContainer::-webkit-scrollbar-track {
                background: transparent;
            }

            #floatingMenuContainer::-webkit-scrollbar-thumb {
                background-color: rgba(100, 100, 100, 0.5);
                border-radius: 4px;
                border: 2px solid transparent;
                background-clip: content-box;
            }

            #floatingMenuContainer::-webkit-scrollbar-thumb:hover {
                background-color: rgba(100, 100, 100, 0.8);
            }

            .group-buttons {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                margin-top: 16px;
            }

            .autoTasks,
            .fixedMasterCodesContainer {
                display: none;
            }

            .autoTasks {
                background-color: #f0f8ff;
                padding: 20px;
                border-radius: 10px;
                max-width: 1000px;
                margin: 0 auto;
            }

            .autoTasks h3 {
                text-align: center;
                margin: 0 0 15px;
            }

            .button-auto {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .form-group-1 {
                display: flex;
                flex-direction: column;
                background-color: #fff;
                padding: 15px;
                border-radius: 8px;
                border: 1px solid #ddd;
            }

            .form-group-1 label {
                margin-bottom: 8px;
                font-weight: 600;
                color: #333;
            }

            #batchSizeInput,
            #alreadyBatchSizeInput,
            #noneBatchSizeInput {
                padding: 8px 12px;
                border: 1px solid #ccc;
                border-radius: 6px;
                font-size: 14px;
                margin-bottom: 10px;
                width: 100%;
                max-width: 60px;
            }

            .btn-generate-batch {
                padding: 10px 16px;
                background-color: #007bff;
                color: #fff;
                border: none;
                font-size: 14px;
                border-radius: 6px;
                cursor: pointer;
                transition: background-color 0.3s ease;
                width: fit-content;
            }

            .btn-generate-batch:hover {
                background-color: #0056b3;
            }

            #linkTextarea {
                font-size: 12px;
            }

            .tags-input {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
                border: 1px solid #ccc;
                padding: 5px;
                border-radius: 4px;
                align-items: center;
                min-height: 36px;
            }

            .tags-input input {
                flex: 0 1 80px;
                border: none;
                outline: none;
                background: transparent;
                font-size: 14px;
                padding: 4px;
                min-width: 100px;
            }

            /* Remove datalist dropdown arrow */
            .tags-input input::-webkit-calendar-picker-indicator {
                display: none !important;
                opacity: 0;
            }

            .tag {
                background-color: #e8f0fe;
                color: #1a73e8;
                padding: 2px 8px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                gap: 5px;
                font-size: 14px;
            }

            .tag button {
                background: transparent;
                border: none;
                color: #1a73e8;
                cursor: pointer;
                font-weight: bold;
                padding: 2px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 4px;
                border-radius: 50%;
                width: 16px;
                height: 16px;
                font-size: 12px;
            }

            .tag button:hover {
                background-color: #d2e3fc;
            }

            .step {
                display: flex;
                flex-direction: column;
                gap: 5px;
                margin-bottom: 10px;
            }

            .btn.danger {
                background-color: #e74c3c;
                color: #fff;
            }

            .btn.danger:hover {
                background-color: #c0392b;
            }

            /* Remove spinner from input */
            .tag-input-field {
                -moz-appearance: textfield !important;
                -webkit-appearance: none !important;
                appearance: none !important;
            }

            /* For Webkit browsers like Chrome/Safari/Edge */
            .tag-input-field::-webkit-inner-spin-button,
            .tag-input-field::-webkit-outer-spin-button,
            .tag-input-field::-webkit-search-cancel-button {
                -webkit-appearance: none !important;
                appearance: none !important;
                display: none !important;
                margin: 0 !important;
            }

            /* For Firefox */
            .tag-input-field[type="number"] {
                -moz-appearance: textfield !important;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div id="floatingMenu">
                <button class="floating-btn" data-target="taskSection"><span class="icon">üõ†Ô∏è</span><span class="btn-label">Tasks</span></button>
                <button class="floating-btn" data-target="languageSection"><span class="icon"> üåê</span><span class="btn-label">Language & Link</span></button>
                <!-- <button class="floating-btn" data-target="fixedMasterCodesContainer"><span class="icon">üìå</span><span class="btn-label">Master code</span></button> -->
                <button class="floating-btn" data-target="savedCustomInputs"><span class="icon">üíæ</span><span class="btn-label">Saved Links</span></button>
                <button class="floating-btn" data-target="fragmentSection"><span class="icon">üß©</span><span class="btn-label">Fragments</span></button>
                <button class="floating-btn" data-target="buttonsSection"><span class="icon">‚öôÔ∏è</span><span class="btn-label">Actions</span></button>
                <button class="floating-btn" data-target="convertText"><span class="icon">üî§</span><span class="btn-label">Convert text</span></button>
            </div>
            <div id="floatingPanels">
                <div id="floatingMenuContainer">
                    <div class="floating-panel" id="taskSection">
                        <h2>Tasks</h2>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="condition" value="radio1" checked />
                                Normal task</label
                            >
                            <label>
                                <input type="checkbox" name="condition" value="radio3" id="fragmentRadio" />
                                Fragment Reskin task
                            </label>
                            <!-- <label>
                            <input type="checkbox" name="condition" value="radio2" />
                            Tagging task (Unit)</label> -->
                            <label>
                                <input type="checkbox" name="condition" value="countries-code" />
                                Countries Code
                            </label>
                            <label>
                                <input type="checkbox" name="condition" value="autoTask" />
                                Auto Task
                            </label>
                            <label>
                                <input type="checkbox" name="condition" value="autoAddLinks" />
                                Auto Add Links
                            </label>
                            <label>
                                <input type="checkbox" name="condition" value="autoAddSttLinks" />
                                Auto Status Links
                            </label>
                        </div>
                    </div>
                    <div class="floating-panel" id="languageSection">
                        <h2>Language & Link</h2>
                        <div class="form-group">
                            <label for="masterLanguage">Master Language:</label>
                            <select id="masterLanguage" onchange="updateLocalLanguages()">
                                <option value="" selected disabled hidden>Choose here</option>
                                <option value="en-GB">en-GB (Master)</option>
                                <option value="bs-BS">bs-BS (Bosnia)</option>
                                <option value="bg-BG">bg-BG (Bulgaria)</option>
                                <option value="hr-HR">hr-HR (Croatia)</option>
                                <option value="cs-CZ">cs-CZ (Czech)</option>
                                <option value="da-DK">da-DK (Denmark)</option>
                                <option value="et-EE">et-EE (Estonian)</option>
                                <option value="fi-FI">fi-FI (Finland)</option>
                                <option value="el-GR">el-GR (Greek)</option>
                                <option value="hu-HU">hu-HU (Hungary)</option>
                                <option value="it-IT">it-IT (Italy)</option>
                                <option value="ja-JP">ja-JP (Japan)</option>
                                <option value="ko-KR">ko-KR (Korea)</option>
                                <option value="lv-LV">lv-LV (Latvia)</option>
                                <option value="lt-LT">lt-LT (Lithuania)</option>
                                <option value="no-NO">no-NO (Norway)</option>
                                <option value="pl-PL">pl-PL (Poland)</option>
                                <option value="ro-RO">ro-RO (Romania)</option>
                                <option value="ru-RU">ru-RU (Russia)</option>
                                <option value="sr-RS">sr-RS (Serbia)</option>
                                <option value="sk-SK">sk-SK (Slovakia)</option>
                                <option value="sl-SI">sl-SI (Slovenia)</option>
                                <option value="sv-SE">sv-SE (Sweden)</option>
                                <option value="th-TH">th-TH (Thailand)</option>
                                <option value="tr-TR">tr-TR (Turkey)</option>
                                <option value="uk-UA">uk-UA (Ukraine)</option>
                                <option value="vi-VI">vi-VI (Vietnamese)</option>
                                <option value="en-AU">en-AU (English (Australia))</option>
                                <option value="en-US">en-US (English (USA))</option>
                                <option value="de-DE">de-DE (Germany)</option>
                                <option value="fr-FR">fr-FR (France)</option>
                                <option value="pt-PT">pt-PT (Portugal)</option>
                                <option value="es-ES">es-ES (Spain)</option>
                                <option value="nl-NL">nl-NL (Netherlands)</option>
                                <option value="zh-CN">zh-CN (China)</option>
                            </select>
                        </div>
                        <div id="localLanguages" class="local-languages"></div>
                        <div class="autoAddlinks">
                            <div class="form-group">
                                <label for="linkTextarea">Auto add multiple links:</label>
                                <textarea id="linkTextarea" rows="10" placeholder="Paste multiple links here, each on a new line..."></textarea>
                                <button id="startButton" style="margin-top: 20px" onclick="processLinks()">Start Processing</button>
                            </div>
                        </div>
                        <div class="autoAddsttlinks">
                            <div class="form-group">
                                <label for="statusTextarea">Auto add status links:</label>
                                <textarea id="statusTextarea" rows="10" placeholder="Paste status links here, each on a new line..."></textarea>
                                <div style="display: flex; gap: 10px; margin-top: 20px">
                                    <button id="startButton" style="flex: 1" onclick="syncStatusFromTextarea()">Start Processing</button>
                                    <button id="clearStatusBtn" style="flex: 1; background-color: #e74c3c" onclick="clearStatusData()">Clear Status</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="customInput">Custom Input:</label>
                            <input type="text" id="customInput" />
                        </div>
                        <div class="check">
                            <a href="https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/language-masters/en-GB" target="_blank">Wrong URL?</a>
                            |
                            <a href="https://www.grundfos.com/components" target="_blank">Brand Components</a>
                        </div>
                        <div id="searchContainer" style="display: none">
                            <div class="form-group">
                                <label for="searchInput">Search Language:</label>
                                <input type="text" id="searchInput" placeholder="Search Language" oninput="handleInputSearch()" />
                            </div>
                            <div id="masterLanguageInfo">Master Language:</div>
                            <div id="localLanguagesInfo">Local Languages:</div>
                            <button id="applySearchButton" onclick="applySearchInput()">Apply Search</button>
                        </div>
                        <div class="fixedMasterCodesContainer" style="margin-top: 20px">
                            <h2>Key Markets</h2>
                            <div id="fixedMasterCodes" style="display: flex; flex-wrap: wrap; gap: 10px"></div>
                            <h2>Country</h2>
                            <div id="customMasterCodes" style="display: flex; flex-wrap: wrap; gap: 10px"></div>

                            <input list="masterLanguages" id="masterLanguageInput" name="masterLanguage" />
                            <datalist id="masterLanguages"> </datalist>

                            <button id="addCustomMasterCode" style="margin-top: 20px">Add Custom Master Code</button>
                        </div>
                        <div class="autoTasks">
                            <div class="autoOpenLinksByClass" style="max-width: 700px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; background: #f9f9f9">
                                <h3>Auto Open Links By Task</h3>

                                <!-- New TypeTask -->
                                <div class="form-group" style="margin-bottom: 15px">
                                    <label for="newTaskInput">New Task:</label>
                                    <div class="input-group" style="display: flex; gap: 10px">
                                        <input type="text" id="newTaskInput" placeholder="Enter task name..." style="flex: 1" />
                                        <button type="button" id="addTypeTaskBtn" class="btn primary">Add TypeTask</button>
                                    </div>
                                </div>

                                <!-- Select TypeTask -->
                                <div class="form-group" style="margin-bottom: 15px">
                                    <label for="taskTypeSelect"><b>Select Task:</b></label>
                                    <div class="input-group" style="display: flex; gap: 10px">
                                        <select id="taskTypeSelect" style="flex: 1"></select>
                                        <button id="deleteTypeTaskBtn" class="btn danger">Delete Task</button>
                                    </div>
                                </div>

                                <!-- Steps Container -->
                                <div id="stepsContainer" style="margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px"></div>

                                <!-- Batch size -->
                                <div class="form-group">
                                    <div class="group" style="margin-bottom: 15px">
                                        <label for="classBatchSize"><b>Batch size:</b></label>
                                        <input type="number" id="classBatchSize" value="1" min="1" style="width: 80px" />
                                    </div>
                                    <!-- Auto Run Button -->
                                    <button id="runClassAutoBtn" class="btn primary full">Auto Run All</button>
                                </div>
                            </div>
                            <h3 style="text-align: left">Backup & Restore</h3>
                            <button id="exportTasksBtn" class="btn">Export Tasks</button>
                            <input type="file" id="importTasksFile" accept=".json" style="display: none" />
                            <button id="importTasksBtn" class="btn">Import Tasks</button>
                            <datalist id="classNameOptions"></datalist>
                        </div>
                    </div>

                    <div class="floating-panel" id="savedCustomInputs">
                        <h2>Save Links (<span id="linkCount">0</span>)</h2>
                        <div id="radioContainer"></div>
                        <button id="clearSavedLinksBtn" onclick="clearRadioSelections()" style="margin-top: 15px; background: #ffdddd; border: 1px solid #ff9999; padding: 6px 12px; border-radius: 8px; cursor: pointer; color: red; width: 100%; font-weight: bold">üßπ Clear Saved Links</button>
                    </div>

                    <div class="floating-panel" id="fragmentSection" class="hidden">
                        <h2>Fragments</h2>
                        <div class="form-group">
                            <input type="text" id="fragmentInput" placeholder="Enter fragment" />
                            <button id="addFragment">Add Fragment</button>
                        </div>
                        <div id="savedFragmentsContainer">
                            <h4>Saved Fragments</h4>
                            <div id="savedFragments"></div>
                        </div>
                        <div class="group-buttons">
                            <button id="clearFragments">Clear Saved Fragments</button>
                            <button id="resetFragmentLinks">Reset Status Fragment Links</button>
                        </div>
                    </div>
                    <div class="floating-panel" id="buttonsSection">
                        <h2>Actions</h2>
                        <div class="group-buttons">
                            <button id="generateAndSaveBtn">Generate & Save</button>
                            <button onclick="generateLinks()">Generate</button>
                            <button id="resetLinks">Reset Status Links</button>
                            <button onclick="generateLanguageSuggestions()">Suggest Language Inputs</button>
                            <button id="toggleSearchButton" onclick="toggleSearchInput()">Show Search Input</button>
                            <button id="openModalButton">Show Table</button>
                        </div>
                        <!-- <div id="buttons"></div> -->
                    </div>
                    <div class="floating-panel" id="convertText">
                        <h2>Convert text</h2>
                        <div class="form-group">
                            <textarea id="inputText" rows="1" placeholder="Enter text here..." oninput="convertText()"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column-right">
                <div id="links"></div>
                <div id="fragmentContainer"></div>
            </div>
        </div>
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="closeModalButton">x</span>
                <div class="table-container">
                    <table border="1">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Grundfos domain</th>
                                <th>Sales Company</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Global</td>
                                <td>WWW</td>
                                <td>Global</td>
                            </tr>
                            <tr>
                                <td>United Kingdom</td>
                                <td>UK</td>
                                <td>GB</td>
                            </tr>
                            <tr>
                                <td>Ireland</td>
                                <td>IE</td>
                                <td>GPI</td>
                            </tr>
                            <tr>
                                <td>Denmark</td>
                                <td>DK</td>
                                <td>GDK</td>
                            </tr>
                            <tr>
                                <td>Norway</td>
                                <td>NO</td>
                                <td>GNO</td>
                            </tr>
                            <tr>
                                <td>Sweden</td>
                                <td>SE</td>
                                <td>GSV</td>
                            </tr>
                            <tr>
                                <td>Finland</td>
                                <td>FI</td>
                                <td>GSF</td>
                            </tr>
                            <tr>
                                <td>Germany</td>
                                <td>DE</td>
                                <td>GWS</td>
                            </tr>
                            <tr>
                                <td>Austria</td>
                                <td>AT</td>
                                <td>GPO</td>
                            </tr>
                            <tr>
                                <td>Schwitzerland</td>
                                <td>CH</td>
                                <td>GPS</td>
                            </tr>
                            <tr>
                                <td>Schwitzerland</td>
                                <td>CH/FR</td>
                                <td>GPS</td>
                            </tr>
                            <tr>
                                <td>France</td>
                                <td>FR</td>
                                <td>GFD</td>
                            </tr>
                            <tr>
                                <td>Belgium</td>
                                <td>BE/FR</td>
                                <td>GBL_FR</td>
                            </tr>
                            <tr>
                                <td>Belgium</td>
                                <td>BE</td>
                                <td>GBL_NL</td>
                            </tr>
                            <tr>
                                <td>Netherlands</td>
                                <td>NL</td>
                                <td>GNL</td>
                            </tr>
                            <tr>
                                <td>Spain</td>
                                <td>ES</td>
                                <td>BGE</td>
                            </tr>
                            <tr>
                                <td>Portugal</td>
                                <td>PT</td>
                                <td>BGP</td>
                            </tr>
                            <tr>
                                <td>Italy</td>
                                <td>IT</td>
                                <td>GIT</td>
                            </tr>
                            <tr>
                                <td>Greece</td>
                                <td>GR</td>
                                <td>GPH</td>
                            </tr>
                            <tr>
                                <td>Poland</td>
                                <td>PL</td>
                                <td>GPL</td>
                            </tr>
                            <tr>
                                <td>Czech republic</td>
                                <td>CZ</td>
                                <td>GCZ</td>
                            </tr>
                            <tr>
                                <td>Slovakia</td>
                                <td>SK</td>
                                <td>GSK</td>
                            </tr>
                            <tr>
                                <td>Latvia</td>
                                <td>LV</td>
                                <td>GLA_LV</td>
                            </tr>
                            <tr>
                                <td>Lithuania</td>
                                <td>LT</td>
                                <td>GLA_LT</td>
                            </tr>
                            <tr>
                                <td>Estonia</td>
                                <td>EE</td>
                                <td>GLA_EE</td>
                            </tr>
                            <tr>
                                <td>United Arab Emirates</td>
                                <td>AE</td>
                                <td>GGD</td>
                            </tr>
                            <tr>
                                <td>Saudi Arabia</td>
                                <td>SA</td>
                                <td>GSA</td>
                            </tr>
                            <tr>
                                <td>Egypt</td>
                                <td>EG</td>
                                <td>GEG</td>
                            </tr>
                            <tr>
                                <td>Turkey</td>
                                <td>TR</td>
                                <td>GTR</td>
                            </tr>
                            <tr>
                                <td>Serbia</td>
                                <td>RS</td>
                                <td>GSE</td>
                            </tr>
                            <tr>
                                <td>Albania</td>
                                <td>AL</td>
                                <td>GSE-AL</td>
                            </tr>
                            <tr>
                                <td>Bosnia Herzegovina</td>
                                <td>BA</td>
                                <td>GBH</td>
                            </tr>
                            <tr>
                                <td>Slovenia</td>
                                <td>SI</td>
                                <td>GSL</td>
                            </tr>
                            <tr>
                                <td>Ukraine</td>
                                <td>UA</td>
                                <td>GUA</td>
                            </tr>
                            <tr>
                                <td>Hungary</td>
                                <td>HU</td>
                                <td>GHU</td>
                            </tr>
                            <tr>
                                <td>Croatia</td>
                                <td>HR</td>
                                <td>GCR</td>
                            </tr>
                            <tr>
                                <td>Romania</td>
                                <td>RO</td>
                                <td>GRO</td>
                            </tr>
                            <tr>
                                <td>Bulgaria</td>
                                <td>BG</td>
                                <td>GBU</td>
                            </tr>
                            <tr>
                                <td>Kazakhstan</td>
                                <td>KZ</td>
                                <td>GKA</td>
                            </tr>
                            <tr>
                                <td>Russia</td>
                                <td>RU</td>
                                <td>GMO</td>
                            </tr>
                            <tr>
                                <td>Belarus</td>
                                <td>BY</td>
                                <td>GMO-BE</td>
                            </tr>
                            <tr>
                                <td>South Africa</td>
                                <td>ZA</td>
                                <td>GZA</td>
                            </tr>
                            <tr>
                                <td>Kenya</td>
                                <td>KE</td>
                                <td>GKE</td>
                            </tr>
                            <tr>
                                <td>Ghana</td>
                                <td>GH</td>
                                <td>GGH</td>
                            </tr>
                            <tr>
                                <td>Australia</td>
                                <td>AU</td>
                                <td>GPA</td>
                            </tr>
                            <tr>
                                <td>New Zealand</td>
                                <td>NZ</td>
                                <td>GNZ</td>
                            </tr>
                            <tr>
                                <td>South Korea</td>
                                <td>KR</td>
                                <td>GPK</td>
                            </tr>
                            <tr>
                                <td>Japan</td>
                                <td>JP</td>
                                <td>GJK</td>
                            </tr>
                            <tr>
                                <td>Philippines</td>
                                <td>PH</td>
                                <td>GPP</td>
                            </tr>
                            <tr>
                                <td>China</td>
                                <td>CH</td>
                                <td>GSH</td>
                            </tr>
                            <tr>
                                <td>Taiwan</td>
                                <td>TW</td>
                                <td>GTS</td>
                            </tr>
                            <tr>
                                <td>India</td>
                                <td>IN</td>
                                <td>GIN</td>
                            </tr>
                            <tr>
                                <td>Vietnam</td>
                                <td>VN</td>
                                <td>GPV</td>
                            </tr>
                            <tr>
                                <td>Thailand</td>
                                <td>TH</td>
                                <td>GTH</td>
                            </tr>
                            <tr>
                                <td>Malaysia</td>
                                <td>MY</td>
                                <td>GPM</td>
                            </tr>
                            <tr>
                                <td>Hong Kong</td>
                                <td>HK</td>
                                <td>GHK</td>
                            </tr>
                            <tr>
                                <td>Singapore</td>
                                <td>SG</td>
                                <td>GSI</td>
                            </tr>
                            <tr>
                                <td>Indonesia</td>
                                <td>ID</td>
                                <td>GAS</td>
                            </tr>
                            <tr>
                                <td>Argentina</td>
                                <td>AR</td>
                                <td>BGA</td>
                            </tr>
                            <tr>
                                <td>Brazil</td>
                                <td>BR</td>
                                <td>GBR</td>
                            </tr>
                            <tr>
                                <td>Chile</td>
                                <td>CL</td>
                                <td>BGC</td>
                            </tr>
                            <tr>
                                <td>Colombia</td>
                                <td>CO</td>
                                <td>GCO</td>
                            </tr>
                            <tr>
                                <td>Peru</td>
                                <td>-</td>
                                <td>GPE</td>
                            </tr>
                            <tr>
                                <td>United States</td>
                                <td>US</td>
                                <td>GPU</td>
                            </tr>
                            <tr>
                                <td>Canada</td>
                                <td>CA</td>
                                <td>GCA</td>
                            </tr>
                            <tr>
                                <td>Canada</td>
                                <td>CA/FR</td>
                                <td>GCA</td>
                            </tr>
                            <tr>
                                <td>Mexico</td>
                                <td>MX</td>
                                <td>GMX</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <script>
            const classMappings = {
                "Live Site en-GB": ".siteliveEngbMaster",
                "Edit Site en-GB": ".editliveEngbMaster",
                "Preview Site en-GB": ".previewliveEngbMaster",

                "Site Live Local Master": ".sitelivelocalMaster",
                "Edit Site Local Master": ".editlocalMaster",
                "Preview Site Local Master": ".previewlocalMaster",
                "Rollout Local Master": ".rolloutlocalMaster",
                "Properties Local Master": ".propertieslocalMaster",

                "Live Site Local": ".liveSiteLocal",
                "Edit Site Local": ".editSiteLocal",
                "Publish Site Local": ".pulishSiteLocal",
                "Preview Site Local": ".previewSiteLocal",
                "Live Site Link": ".liveSiteLink",

                "Fragment Live Site en-GB": ".fragment-sitelive-enGB",
                "Fragment Edit Site en-GB": ".fragment-edit-enGB",
                "Fragment Preview Site en-GB": ".fragment-preview-enGB",

                "Fragment Site Live Local Master": ".fragment-sitelive-localMaster",
                "Fragment Edit Site Local Master": ".fragment-edit-localMaster",
                "Fragment Preview Site Local Master": ".fragment-preview-localMaster",
                "Fragment Rollout Local Master": ".fragment-rollout-localMaster",

                "Fragment Live Site Local": ".fragment-sitelive-livesitelocal",
                "Fragment Edit Site Local": ".fragment-edit-livesitelocal",
                "Fragment Publish Site Local": ".fragment-publish-livesitelocal",
                "Fragment Preview Site Local": ".fragment-preview-livesitelocal",
            };

            document.getElementById("deleteTypeTaskBtn").addEventListener("click", () => {
                if (!currentTask) return alert("No task selected!");
                if (!confirm(`Are you sure you want to delete type task "${currentTask}"? This will remove all its steps.`)) return;

                delete typeTasks[currentTask];

                const remainingTasks = Object.keys(typeTasks);
                currentTask = remainingTasks[0] || null;

                refreshTaskSelect();
                renderSteps();
                saveStateToLocal();
            });
            const typeTasks = {};
            let currentTask = null;
            function saveStateToLocal() {
                const data = {
                    typeTasks,
                    currentTask,
                    batchSize: parseInt(document.getElementById("classBatchSize").value, 10) || 1,
                };
                localStorage.setItem("classTaskState", JSON.stringify(data));
            }
            function restoreStateFromLocal() {
                const data = JSON.parse(localStorage.getItem("classTaskState") || "{}");
                if (!data.typeTasks) return;
                Object.assign(typeTasks, data.typeTasks);
                currentTask = data.currentTask || Object.keys(typeTasks)[0] || null;
                document.getElementById("classBatchSize").value = data.batchSize || 1;
                refreshTaskSelect();
                renderSteps();
            }

            function initializeDefaultState() {
                const savedInputs = JSON.parse(localStorage.getItem("savedInputs") || "[]");
                if (savedInputs.length === 0) {
                    clearRadioSelections();
                }
            }

            let availableClassNamesCache = [];

            function scanAvailableClassNames() {
                const links = document.querySelector("#links");
                const fragments = document.querySelector("#fragmentContainer");

                const result = [];
                Object.entries(classMappings).forEach(([name, selector]) => {
                    const present = (links && links.querySelector(selector)) || (fragments && fragments.querySelector(selector));
                    if (present) result.push(name);
                });
                return result;
            }

            function getAvailableClassNames() {
                if (!availableClassNamesCache.length) {
                    availableClassNamesCache = scanAvailableClassNames();
                }
                return availableClassNamesCache;
            }
            function renderClassNameOptions() {
                const dl = document.getElementById("classNameOptions");
                dl.innerHTML = "";
                const groups = {
                    engb: [],
                    localMaster: [],
                    siteLocal: [],
                    fragmentEngb: [],
                    fragmentLocalMaster: [],
                    fragmentSiteLocal: [],
                };

                getAvailableClassNames().forEach((name) => {
                    if (name.includes("en-GB") && !name.includes("Fragment")) {
                        groups.engb.push(name);
                    } else if (name.includes("Local Master") && !name.includes("Fragment")) {
                        groups.localMaster.push(name);
                    } else if ((name.includes("Site Local") || name.includes("Link")) && !name.includes("Fragment")) {
                        groups.siteLocal.push(name);
                    } else if (name.includes("Fragment") && name.includes("en-GB")) {
                        groups.fragmentEngb.push(name);
                    } else if (name.includes("Fragment") && name.includes("Local Master")) {
                        groups.fragmentLocalMaster.push(name);
                    } else if (name.includes("Fragment") && name.includes("Site Local")) {
                        groups.fragmentSiteLocal.push(name);
                    }
                });
                function addOptionsGroup(options, dividerText) {
                    if (options.length) {
                        const divider = document.createElement("option");
                        divider.disabled = true;
                        divider.style.fontWeight = "bold";
                        divider.style.backgroundColor = "#f0f0f0";
                        divider.text = "‚îÄ‚îÄ‚îÄ‚îÄ " + dividerText + " ‚îÄ‚îÄ‚îÄ‚îÄ";
                        dl.appendChild(divider);

                        options.forEach((name) => {
                            const opt = document.createElement("option");
                            opt.value = name;
                            dl.appendChild(opt);
                        });
                    }
                }
                addOptionsGroup(groups.engb, "English GB Links");
                addOptionsGroup(groups.localMaster, "Local Master Links");
                addOptionsGroup(groups.siteLocal, "Site Local Links");
                addOptionsGroup(groups.fragmentEngb, "Fragment English GB");
                addOptionsGroup(groups.fragmentLocalMaster, "Fragment Local Master");
                addOptionsGroup(groups.fragmentSiteLocal, "Fragment Site Local");
            }
            renderClassNameOptions();
            function refreshTagOptionsFromDOM() {
                availableClassNamesCache = scanAvailableClassNames();
                renderClassNameOptions();
                updateAllDatalists();
            }
            window.addEventListener("DOMContentLoaded", () => {
                restoreStateFromLocal();
                initializeDefaultState();
                observeLinkZones();

                refreshTagOptionsFromDOM();
                setTimeout(refreshTagOptionsFromDOM, 200);
            });
            function debounce(fn, wait = 100) {
                let t;
                return function (...args) {
                    clearTimeout(t);
                    t = setTimeout(() => fn.apply(this, args), wait);
                };
            }

            function observeLinkZones() {
                const targets = [document.querySelector("#links"), document.querySelector("#fragmentContainer")].filter(Boolean);

                if (!targets.length) return;

                const onMutate = debounce(() => {
                    refreshTagOptionsFromDOM();
                    saveStateToLocal?.();
                }, 100);

                const obs = new MutationObserver(onMutate);
                targets.forEach((t) => {
                    obs.observe(t, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeFilter: ["style", "class"],
                    });
                });
            }
            document.getElementById("addTypeTaskBtn").addEventListener("click", () => {
                const input = document.getElementById("newTaskInput");
                const name = input.value.trim();
                if (!name) return alert("Enter type task name!");
                if (typeTasks[name]) return alert("Type task already exists!");
                typeTasks[name] = [];
                currentTask = name;
                input.value = "";
                refreshTaskSelect();
                renderSteps();
                saveStateToLocal();
            });
            function refreshTaskSelect() {
                const select = document.getElementById("taskTypeSelect");
                select.innerHTML = "";
                Object.keys(typeTasks).forEach((task) => {
                    const opt = document.createElement("option");
                    opt.value = task;
                    opt.textContent = task;
                    if (task === currentTask) opt.selected = true;
                    select.appendChild(opt);
                });
            }
            document.getElementById("taskTypeSelect").addEventListener("change", (e) => {
                currentTask = e.target.value;
                renderSteps();
                saveStateToLocal();
            });
            function createTagsInput(selectedTags, stepIdx) {
                const wrapper = document.createElement("div");
                wrapper.className = "tags-input";

                const input = document.createElement("input");
                const dlId = "classNameOptionsStep" + stepIdx;
                input.setAttribute("list", dlId);
                input.className = "tag-input-field";
                wrapper.appendChild(input);

                const dl = document.createElement("datalist");
                dl.id = dlId;
                wrapper.appendChild(dl);

                function updateDatalist() {
                    dl.innerHTML = "";
                    const usedTags = getUsedTagsExceptCurrentStep(stepIdx);
                    const groups = {
                        engb: [],
                        localMaster: [],
                        siteLocal: [],
                        fragmentEngb: [],
                        fragmentLocalMaster: [],
                        fragmentSiteLocal: [],
                    };

                    const availableClassNames = getAvailableClassNames();

                    getAvailableClassNames().forEach((name) => {
                        if (usedTags.includes(name) || selectedTags.includes(name)) return;

                        if (name.includes("en-GB") && !name.includes("Fragment")) {
                            groups.engb.push(name);
                        } else if (name.includes("Local Master") && !name.includes("Fragment")) {
                            groups.localMaster.push(name);
                        } else if ((name.includes("Site Local") || name.includes("Link")) && !name.includes("Fragment")) {
                            groups.siteLocal.push(name);
                        } else if (name.includes("Fragment") && name.includes("en-GB")) {
                            groups.fragmentEngb.push(name);
                        } else if (name.includes("Fragment") && name.includes("Local Master")) {
                            groups.fragmentLocalMaster.push(name);
                        } else if (name.includes("Fragment") && name.includes("Site Local")) {
                            groups.fragmentSiteLocal.push(name);
                        }
                    });
                    function addOptionsGroup(options, dividerText) {
                        if (options.length) {
                            const divider = document.createElement("option");

                            divider.style.pointerEvents = "none";
                            divider.style.fontWeight = "bold";
                            divider.style.backgroundColor = "#f0f0f0";
                            divider.text = "‚îÄ‚îÄ‚îÄ‚îÄ " + dividerText + " ‚îÄ‚îÄ‚îÄ‚îÄ";
                            dl.appendChild(divider);
                            options.forEach((name) => {
                                const opt = document.createElement("option");
                                opt.value = name;
                                dl.appendChild(opt);
                            });
                        }
                    }
                    addOptionsGroup(groups.engb, "English GB Links");
                    addOptionsGroup(groups.localMaster, "Local Master Links");
                    addOptionsGroup(groups.siteLocal, "Site Local Links");
                    addOptionsGroup(groups.fragmentEngb, "Fragment English GB");
                    addOptionsGroup(groups.fragmentLocalMaster, "Fragment Local Master");
                    addOptionsGroup(groups.fragmentSiteLocal, "Fragment Site Local");
                }

                function renderTags() {
                    wrapper.querySelectorAll(".tag").forEach((el) => el.remove());
                    selectedTags.forEach((tag, idx) => {
                        const tagEl = document.createElement("span");
                        tagEl.className = "tag";
                        tagEl.textContent = tag;

                        const btn = document.createElement("button");
                        btn.textContent = "x";
                        btn.onclick = () => {
                            selectedTags.splice(idx, 1);
                            renderTags();
                            updateDatalist();
                            updateAllDatalists();
                            saveStateToLocal();
                        };
                        tagEl.appendChild(btn);
                        wrapper.insertBefore(tagEl, input);
                    });

                    updateDatalist();
                    saveStateToLocal();
                }

                input.addEventListener("keydown", (e) => {
                    if ((e.key === "Enter" || e.key === ",") && input.value.trim()) {
                        e.preventDefault();
                        const val = input.value.trim();
                        const usedTags = getUsedTagsExceptCurrentStep(stepIdx);
                        if (classMappings[val] && !selectedTags.includes(val) && !usedTags.includes(val)) {
                            selectedTags.push(val);
                            renderTags();
                            updateAllDatalists();
                            saveStateToLocal();
                        }
                        input.value = "";
                    }
                });

                input.addEventListener("change", () => {
                    const val = input.value.trim();
                    const usedTags = getUsedTagsExceptCurrentStep(stepIdx);
                    if (classMappings[val] && !selectedTags.includes(val) && !usedTags.includes(val)) {
                        selectedTags.push(val);
                        renderTags();
                        updateAllDatalists();
                        saveStateToLocal();
                    }
                    input.value = "";
                });
                renderTags();
                return wrapper;
            }
            function updateAllDatalists() {
                const allSteps = document.querySelectorAll("#stepsContainer .step");
                allSteps.forEach((stepEl, idx) => {
                    const wrapper = stepEl.querySelector(".tags-input");
                    const dl = wrapper.querySelector("datalist");
                    const input = wrapper.querySelector("input");
                    if (!dl || !input) return;

                    const selectedTags = Array.from(wrapper.querySelectorAll(".tag")).map((tagEl) => tagEl.childNodes[0].nodeValue.trim());
                    const usedTags = getUsedTagsExceptCurrentStep(idx);

                    dl.innerHTML = "";

                    const groups = {
                        engb: [],
                        localMaster: [],
                        siteLocal: [],
                        fragmentEngb: [],
                        fragmentLocalMaster: [],
                        fragmentSiteLocal: [],
                    };

                    const availableClassNames = getAvailableClassNames();

                    availableClassNames.forEach((name) => {
                        if (usedTags.includes(name) || selectedTags.includes(name)) return;

                        if (name.includes("en-GB") && !name.includes("Fragment")) {
                            groups.engb.push(name);
                        } else if (name.includes("Local Master") && !name.includes("Fragment")) {
                            groups.localMaster.push(name);
                        } else if ((name.includes("Site Local") || name.includes("Link")) && !name.includes("Fragment")) {
                            groups.siteLocal.push(name);
                        } else if (name.includes("Fragment") && name.includes("en-GB")) {
                            groups.fragmentEngb.push(name);
                        } else if (name.includes("Fragment") && name.includes("Local Master")) {
                            groups.fragmentLocalMaster.push(name);
                        } else if (name.includes("Fragment") && name.includes("Site Local")) {
                            groups.fragmentSiteLocal.push(name);
                        }
                    });
                    function addOptionsGroup(options, dividerText) {
                        if (options.length) {
                            const divider = document.createElement("option");

                            divider.style.pointerEvents = "none";
                            divider.style.fontWeight = "bold";
                            divider.style.backgroundColor = "#f0f0f0";
                            divider.text = "‚îÄ‚îÄ‚îÄ‚îÄ " + dividerText + " ‚îÄ‚îÄ‚îÄ‚îÄ";
                            dl.appendChild(divider);
                            options.forEach((name) => {
                                const opt = document.createElement("option");
                                opt.value = name;
                                dl.appendChild(opt);
                            });
                        }
                    }
                    addOptionsGroup(groups.engb, "English GB Links");
                    addOptionsGroup(groups.localMaster, "Local Master Links");
                    addOptionsGroup(groups.siteLocal, "Site Local Links");
                    addOptionsGroup(groups.fragmentEngb, "Fragment English GB");
                    addOptionsGroup(groups.fragmentLocalMaster, "Fragment Local Master");
                    addOptionsGroup(groups.fragmentSiteLocal, "Fragment Site Local");
                });
            }
            function renderSteps() {
                const container = document.getElementById("stepsContainer");
                container.innerHTML = "";
                if (!currentTask) return;

                const steps = typeTasks[currentTask];
                steps.forEach((names, idx) => {
                    const div = document.createElement("div");
                    div.className = "step";
                    div.style.display = "flex";
                    div.style.flexDirection = "column";
                    div.style.gap = "8px";
                    div.style.padding = "10px";
                    div.style.border = "1px solid #ccc";
                    div.style.borderRadius = "8px";
                    div.style.background = "#fff";
                    const tagsInput = createTagsInput(names, idx);

                    tagsInput.querySelector("input").style.appearance = "none";
                    tagsInput.querySelector("input").style.webkitAppearance = "none";

                    div.appendChild(tagsInput);
                    const btnGroup = document.createElement("div");
                    btnGroup.style.display = "flex";
                    btnGroup.style.gap = "10px";
                    const runBtn = document.createElement("button");
                    runBtn.textContent = `Run Step ${idx + 1}`;
                    runBtn.className = "btn primary";
                    runBtn.style.flex = "1";
                    runBtn.onclick = async () => {
                        const currentTags = Array.from(tagsInput.children)
                            .filter((el) => el.classList.contains("tag"))
                            .map((tagEl) => tagEl.childNodes[0].nodeValue.trim());
                        if (!currentTags.length) return alert("Step has no tags!");
                        const batchSize = parseInt(document.getElementById("classBatchSize").value, 10) || 1;

                        await runStepWithBatch(currentTags, batchSize);

                        if (idx === typeTasks[currentTask].length - 1) {
                            const radios = Array.from(document.querySelectorAll("#radioContainer input[type='radio']"));
                            const currentRadio = radios.find((r) => r.checked) || radios[0];
                            const nextIndex = radios.indexOf(currentRadio) + 1;
                            if (nextIndex < radios.length) {
                                radios[nextIndex].checked = true;
                                updateCustomInput(radios[nextIndex]);
                                updateSavedLinksCount();
                            }
                        }
                    };

                    btnGroup.appendChild(runBtn);
                    const delBtn = document.createElement("button");
                    delBtn.textContent = "Delete Step";
                    delBtn.className = "btn danger";
                    delBtn.style.flex = "1";
                    delBtn.onclick = () => {
                        typeTasks[currentTask].splice(idx, 1);
                        renderSteps();
                        saveStateToLocal();
                    };
                    btnGroup.appendChild(delBtn);

                    div.appendChild(btnGroup);
                    container.appendChild(div);
                });
                const addBtn = document.createElement("button");
                addBtn.type = "button";
                addBtn.textContent = "+ Add Step";
                addBtn.className = "btn primary full";
                addBtn.style.width = "100%";
                addBtn.onclick = () => {
                    typeTasks[currentTask].push([]);
                    renderSteps();
                    saveStateToLocal();
                };
                container.appendChild(addBtn);
            }
            document.getElementById("runClassAutoBtn").addEventListener("click", async () => {
                if (!currentTask) return alert("Please select a type task!");
                const steps = typeTasks[currentTask];
                const batchSize = parseInt(document.getElementById("classBatchSize").value, 10) || 1;

                for (let stepIndex = 0; stepIndex < steps.length; stepIndex++) {
                    const tagsInputDiv = document.querySelectorAll("#stepsContainer .step")[stepIndex].querySelector(".tags-input");
                    const currentTags = Array.from(tagsInputDiv.children)
                        .filter((el) => el.classList.contains("tag"))
                        .map((tagEl) => tagEl.childNodes[0].nodeValue.trim());

                    if (currentTags.length > 0) {
                        await runStepWithBatch(currentTags, batchSize);
                    }
                }

                const radios = Array.from(document.querySelectorAll("#radioContainer input[type='radio']"));
                const currentRadio = radios.find((r) => r.checked) || radios[0];
                const nextIndex = radios.indexOf(currentRadio) + 1;
                if (nextIndex < radios.length) {
                    radios[nextIndex].checked = true;
                    updateCustomInput(radios[nextIndex]);
                    updateSavedLinksCount();
                }
            });

            function getUsedTagsExceptCurrentStep(currentStepIdx) {
                if (!currentTask) return [];
                return typeTasks[currentTask].filter((_, idx) => idx !== currentStepIdx).flat();
            }

            function runStepWithBatch(stepTags, batchSize = 1) {
                return new Promise((resolve) => {
                    const radios = Array.from(document.querySelectorAll("#radioContainer input[type='radio']"));
                    if (!radios.length) return resolve();

                    let currentRadioIdx = radios.findIndex((r) => r.checked);
                    let processed = 0;
                    const delay = 500;

                    function processNext() {
                        if (currentRadioIdx >= radios.length || processed >= batchSize) {
                            resolve();
                            return;
                        }

                        const radio = radios[currentRadioIdx];
                        radio.checked = true;
                        updateCustomInput(radio);

                        stepTags.forEach((tag) => {
                            const sel = classMappings[tag];
                            if (!sel) return;

                            const elements = document.querySelectorAll(`#links ${sel}, #fragmentContainer ${sel}`);

                            elements.forEach((a) => {
                                if (a.href) {
                                    window.open(a.href, "_blank");
                                }
                            });
                        });

                        processed++;
                        currentRadioIdx++;
                        updateSavedLinksCount();

                        setTimeout(processNext, delay);
                    }

                    processNext();
                });
            }

            document.getElementById("exportTasksBtn").addEventListener("click", () => {
                const data = {
                    typeTasks,
                    currentTask,
                    batchSize: parseInt(document.getElementById("classBatchSize").value, 10) || 1,
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: "application/json",
                });
                const url = URL.createObjectURL(blob);

                const a = document.createElement("a");
                a.href = url;
                a.download = "tasks.json";
                a.click();

                URL.revokeObjectURL(url);
            });
            document.getElementById("importTasksBtn").addEventListener("click", () => {
                document.getElementById("importTasksFile").click();
            });

            document.getElementById("importTasksFile").addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (!data.typeTasks || typeof data.typeTasks !== "object") {
                            return alert("Invalid file format!");
                        }
                        Object.keys(typeTasks).forEach((key) => delete typeTasks[key]);
                        Object.assign(typeTasks, data.typeTasks);
                        currentTask = data.currentTask || Object.keys(typeTasks)[0] || null;
                        document.getElementById("classBatchSize").value = data.batchSize || 1;

                        refreshTaskSelect();
                        renderSteps();
                        saveStateToLocal();

                        alert("Tasks imported successfully!");
                    } catch (err) {
                        console.error(err);
                        alert("Error reading JSON file!");
                    }
                };
                reader.readAsText(file);
            });
            document.getElementById("classBatchSize").addEventListener("change", saveStateToLocal);
            function clearStatusData() {
                if (!confirm("Are you sure you want to clear all status data?")) return;

                localStorage.removeItem("savedStatuses");
                localStorage.removeItem("statusTextareaRaw");
                document.getElementById("statusTextarea").value = "";
                alert("Status data cleared successfully!");
            }
            const localLanguages = {
                "en-GB": ["en-GB", "ie/en", "gb/en", "my/en", "hk/en", "id/en", "ph/en", "in/en", "sg/en", "gh/en", "eg/en", "al/en", "sa/en", "ke/en", "ae/en", "za/en", "www/en"],
                "bs-BS": ["ba/bs"],
                "bg-BG": ["bg/bg"],
                "hr-HR": ["hr/hr"],
                "cs-CZ": ["cz/cs"],
                "da-DK": ["dk/da"],
                "et-EE": ["ee/et"],
                "fi-FI": ["fi/fi"],
                "el-GR": ["gr/el"],
                "hu-HU": ["hu/hu"],
                "it-IT": ["it/it"],
                "ja-JP": ["jp/ja"],
                "ko-KR": ["kr/ko"],
                "lv-LV": ["lv/lv"],
                "lt-LT": ["lt/lt"],
                "no-NO": ["no/no"],
                "pl-PL": ["pl/pl"],
                "ro-RO": ["ro/ro"],
                "ru-RU": ["ru/ru"],
                "sr-RS": ["rs/sr"],
                "sk-SK": ["sk/sk"],
                "sl-SI": ["si/sl"],
                "sv-SE": ["se/sv"],
                "th-TH": ["th/th"],
                "tr-TR": ["tr/tr"],
                "uk-UA": ["ua/uk"],
                "vi-VI": ["vn/vi"],
                "en-AU": ["en-AU", "au/en", "nz/en"],
                "en-US": ["en-US", "us/en", "ca/en"],
                "de-DE": ["de-DE", "de/de", "at/de", "ch/de"],
                "fr-FR": ["fr-FR", "fr/fr", "ca/fr", "ch/fr", "be/fr"],
                "pt-PT": ["pt-PT", "pt/pt", "br/pt"],
                "es-ES": ["es-ES", "es/es", "cl/es", "co/es", "ar/es", "mx/es"],
                "nl-NL": ["nl-NL", "nl/nl", "be/nl"],
                "ru-RU": ["ru-RU", "ru/ru", "by/ru", "kz/ru"],
                "zh-CN": ["zh-CN", "cn/zh", "tw/zh"],
            };
            const languageMapping = {
                Global: ["www/en"],
                GB: ["gb/en"],
                GSV: ["se/sv"],
                GDK: ["dk/da"],
                GNO: ["no/no"],
                GSF: ["fi/fi"],
                GWS: ["de/de"],
                GPO: ["at/de"],
                GPS_DE: ["ch/de"],
                GPS_FR: ["ch/fr"],
                GFD: ["fr/fr"],
                GBL_FR: ["be/fr"],
                GBL_NL: ["be/nl"],
                GNL: ["nl/nl"],
                BGE: ["es/es"],
                BGP: ["pt/pt"],
                GPH: ["gr/el"],
                GPL: ["pl/pl"],
                GCZ: ["cz/cs"],
                GSK: ["sk/sk"],
                GLA_LV: ["lv/lv"],
                GLA_LT: ["lt/lt"],
                GLA_EE: ["ee/et"],
                GGD: ["ae/en"],
                GSA: ["sa/en"],
                GEG: ["eg/en"],
                GTR: ["tr/tr"],
                GSE: ["rs/sr"],
                GSE_AL: ["al/en"],
                GBH: ["ba/bs"],
                GSL: ["si/sl"],
                GUA: ["ua/uk"],
                GHU: ["hu/hu"],
                GCR: ["hr/hr"],
                GRO: ["ro/ro"],
                GBU: ["bg/bg"],
                GKA: ["kz/ru"],
                GMO: ["ru/ru"],
                GMO_BE: ["by/ru"],
                GZA: ["za/en"],
                GKE: ["ke/en"],
                GGH: ["gh/en"],
                GPA: ["au/en"],
                GNZ: ["nz/en"],
                GPK: ["kr/ko"],
                GJK: ["jp/ja"],
                GPP: ["ph/en"],
                GSH: ["cn/zh"],
                GTS: ["tw/zh"],
                GIN: ["in/en"],
                GPV: ["vn/vi"],
                GTH: ["th/th"],
                GPM: ["my/en"],
                GHK: ["hk/en"],
                GSI: ["sg/en"],
                GAS: ["id/en"],
                BGA: ["ar/es"],
                GBR: ["br/pt"],
                BGC: ["cl/es"],
                GCO: ["co/es"],
                GPU: ["us/en"],
                GCA: ["ca/en"],
                GCA_FR: ["ca/fr"],
                GMX: ["mx/es"],
            };

            /**
             * Synchronizes the status from textarea with the radio buttons and localStorage
             * Supports two formats:
             * 1. URL: Status (with colon)
             * 2. Simple list of statuses (without colon)
             * Updates both the UI and localStorage with synchronized status
             */
            function syncStatusFromTextarea() {
                const textarea = document.getElementById("statusTextarea");
                const statusLines = textarea.value.split("\n").map((line) => line.trim());
                const radios = document.querySelectorAll("#radioContainer input[type='radio']");
                const savedStatuses = {};
                const linesToSaveBack = [];

                const hasColonFormat = statusLines.some((line) => line.includes(":"));

                if (hasColonFormat) {
                    statusLines.forEach((line) => {
                        const [inputValue, status] = line.split(":").map((s) => s.trim());
                        if (inputValue && status) {
                            savedStatuses[inputValue] = status;
                        }
                    });
                } else {
                    radios.forEach((radio, index) => {
                        if (index < statusLines.length) {
                            const inputValue = radio.value;
                            const status = statusLines[index];
                            savedStatuses[inputValue] = status;
                        }
                    });
                }

                radios.forEach((radio) => {
                    const inputValue = radio.value;
                    const status = savedStatuses[inputValue] || "";
                    linesToSaveBack.push(`${inputValue}: ${status}`);
                });

                localStorage.setItem("savedStatuses", JSON.stringify(savedStatuses));
                const rawText = linesToSaveBack.join("\n");
                localStorage.setItem("statusTextareaRaw", rawText);

                document.getElementById("statusTextarea").value = rawText;

                console.log("Saved statuses:", savedStatuses);
            }
            function restoreStatusTextareaRaw() {
                const raw = localStorage.getItem("statusTextareaRaw") || "";
                document.getElementById("statusTextarea").value = raw;
            }

            function updateStatusTextareaRawFromSaved() {
                const savedInputs = JSON.parse(localStorage.getItem("savedInputs") || "[]");
                const savedStatuses = JSON.parse(localStorage.getItem("savedStatuses") || "{}");

                const lines = savedInputs.map((input) => `${input}: ${savedStatuses[input] || ""}`);
                const rawText = lines.join("\n");

                localStorage.setItem("statusTextareaRaw", rawText);
                document.getElementById("statusTextarea").value = rawText;
            }
            function processLinks() {
                let links = document.getElementById("linkTextarea").value.trim().split("\n");
                if (links.length > 0) {
                    let index = 0;
                    function autoFillAndSubmit() {
                        if (index < links.length) {
                            let link = links[index].trim();
                            document.getElementById("customInput").value = link;
                            let event = new KeyboardEvent("keydown", {
                                bubbles: true,
                                cancelable: true,
                                key: "Enter",
                                keyCode: 13,
                                code: "Enter",
                            });
                            document.getElementById("customInput").dispatchEvent(event);
                            index++;
                            setTimeout(autoFillAndSubmit, 1000);
                        } else {
                            document.getElementById("linkTextarea").value = "";
                        }
                    }
                    autoFillAndSubmit();
                } else {
                    alert("Please paste at least one link!");
                }
            }
            const countriesCodeCheckbox = document.querySelector('input[name="condition"][value="countries-code"]');
            const countriesCode = document.querySelector(".fixedMasterCodesContainer");
            function togglecountriesCodeButtons() {
                if (!countriesCodeCheckbox || !countriesCode) return;
                countriesCode.style.display = countriesCodeCheckbox.checked ? "block" : "none";
            }
            countriesCodeCheckbox.addEventListener("change", togglecountriesCodeButtons);

            window.addEventListener("load", togglecountriesCodeButtons);

            const autoTaskCheckbox = document.querySelector('input[name="condition"][value="autoTask"]');
            const autoTasks = document.querySelector(".autoTasks");
            function toggleAutoTaskButtons() {
                if (!autoTaskCheckbox || !autoTasks) return;
                autoTasks.style.display = autoTaskCheckbox.checked ? "block" : "none";
            }
            autoTaskCheckbox.addEventListener("change", toggleAutoTaskButtons);
            window.addEventListener("load", toggleAutoTaskButtons);

            const autoAddlinksCheckbox = document.querySelector('input[name="condition"][value="autoAddLinks"]');
            const autoAddlinks = document.querySelector(".autoAddlinks");
            function toggleAutoAddLinkButtons() {
                if (!autoAddlinksCheckbox || !autoAddlinks) return;
                autoAddlinks.style.display = autoAddlinksCheckbox.checked ? "block" : "none";
            }
            autoAddlinksCheckbox.addEventListener("change", toggleAutoAddLinkButtons);

            window.addEventListener("load", toggleAutoAddLinkButtons);

            const autoAddSttlinksCheckbox = document.querySelector('input[name="condition"][value="autoAddSttLinks"]');
            const autoAddSttlinks = document.querySelector(".autoAddsttlinks");
            function toggleAutoAddSttLinkButtons() {
                if (!autoAddSttlinksCheckbox || !autoAddSttlinks) return;
                autoAddSttlinks.style.display = autoAddSttlinksCheckbox.checked ? "block" : "none";
            }
            autoAddSttlinksCheckbox.addEventListener("change", toggleAutoAddSttLinkButtons);

            window.addEventListener("load", toggleAutoAddSttLinkButtons);

            document.querySelectorAll(".floating-btn").forEach((btn) => {
                btn.addEventListener("click", () => {
                    const targetId = btn.dataset.target;
                    const panel = document.getElementById(targetId);
                    if (panel) {
                        panel.classList.toggle("show");
                        savePanelShowState(targetId, panel.classList.contains("show"));
                        updateActiveButtons();
                        if (targetId === "savedCustomInputs" && panel.classList.contains("show")) {
                            loadSavedInputsFromStorage();
                        }
                    }
                });
            });
            function updateActiveButtons() {
                document.querySelectorAll(".floating-btn").forEach((btn) => {
                    const panelId = btn.dataset.target;
                    const panel = document.getElementById(panelId);
                    if (panel && panel.classList.contains("show")) {
                        btn.classList.add("active");
                    } else {
                        btn.classList.remove("active");
                    }
                });
            }
            function savePanelShowState(panelId, isShown) {
                let panelsState = JSON.parse(localStorage.getItem("panelsShowState") || "{}");
                panelsState[panelId] = isShown;
                localStorage.setItem("panelsShowState", JSON.stringify(panelsState));
            }
            window.addEventListener("DOMContentLoaded", () => {
                const panelsState = JSON.parse(localStorage.getItem("panelsShowState") || "{}");
                for (const [panelId, isShown] of Object.entries(panelsState)) {
                    const panel = document.getElementById(panelId);
                    if (panel) {
                        if (isShown) {
                            panel.classList.add("show");
                        } else {
                            panel.classList.remove("show");
                        }
                    }
                }
                updateActiveButtons();
            });
            document.getElementById("generateAndSaveBtn").addEventListener("click", async function () {
                const customInput = document.getElementById("customInput").value.trim();
                if (!customInput) return;
                await generateLinks();
                processAndAddCustomInput();
                const container = document.getElementById("radioContainer");
            });
            function saveSelectedInput(input) {
                localStorage.setItem("selectedInput", input);
            }
            function getSelectedInput() {
                return localStorage.getItem("selectedInput") || "";
            }
            const fixedMasterCodes = ["zh-CN", "da-DK", "fr-FR", "de-DE", "hu-HU", "es-ES", "sr-RS"];
            const fixedContainer = document.getElementById("fixedMasterCodes");
            fixedMasterCodes.forEach((code) => {
                const button = document.createElement("button");
                button.textContent = code;
                button.style.backgroundColor = "#fff";
                button.style.border = "1px solid #007bff";
                button.style.padding = "10px 0.5vw";
                button.style.color = "#007bff";
                button.style.borderRadius = "5px";
                button.style.cursor = "pointer";
                button.onclick = function () {
                    document.getElementById("masterLanguage").value = code;
                    updateLocalLanguages();
                };
                fixedContainer.appendChild(button);
                button.onmouseover = function () {
                    button.style.backgroundColor = "#007bff";
                    button.style.color = "#fff";
                };
                button.onmouseout = function () {
                    button.style.backgroundColor = "#fff";
                    button.style.color = "#007bff";
                };
            });

            const selectElement = document.getElementById("masterLanguage");
            const datalistElement = document.getElementById("masterLanguages");
            const addCustomMasterCodeButton = document.getElementById("addCustomMasterCode");
            const customMasterCodesContainer = document.getElementById("customMasterCodes");
            const masterLanguageInput = document.getElementById("masterLanguageInput");
            const tagsContainer = document.createElement("div");
            tagsContainer.className = "tags-input";
            tagsContainer.style.display = "flex";
            tagsContainer.style.flexWrap = "wrap";
            tagsContainer.style.gap = "5px";
            tagsContainer.style.padding = "5px";
            tagsContainer.style.border = "1px solid #ddd";
            tagsContainer.style.borderRadius = "4px";
            tagsContainer.style.marginTop = "20px";
            tagsContainer.style.alignItems = "center";
            masterLanguageInput.parentNode.insertBefore(tagsContainer, masterLanguageInput);
            masterLanguageInput.style.appearance = "none";
            masterLanguageInput.style.webkitAppearance = "none";
            masterLanguageInput.style.border = "none";
            masterLanguageInput.style.outline = "none";
            masterLanguageInput.style.minWidth = "60px";
            masterLanguageInput.style.flexGrow = "1";
            masterLanguageInput.style.padding = "4px";
            tagsContainer.appendChild(masterLanguageInput);

            let selectedTags = JSON.parse(localStorage.getItem("selectedTags") || "[]");

            function saveSelectedTags() {
                localStorage.setItem("selectedTags", JSON.stringify(selectedTags));
            }

            function loadSelectToDatalist() {
                datalistElement.innerHTML = "";
                Array.from(selectElement.options).forEach((option) => {
                    if (option.value && !selectedTags.includes(option.value)) {
                        const newOption = document.createElement("option");
                        newOption.value = option.value;
                        datalistElement.appendChild(newOption);
                    }
                });
            }
            selectedTags.forEach((code) => {
                const tag = createTag(code);
                tagsContainer.insertBefore(tag, masterLanguageInput);
                const button = document.createElement("button");
                button.textContent = code;
                button.style.backgroundColor = "#fff";
                button.style.border = "1px solid #007bff";
                button.style.padding = "10px 0.5vw";
                button.style.color = "#007bff";
                button.style.borderRadius = "5px";
                button.style.cursor = "pointer";
                button.onclick = function () {
                    Array.from(customMasterCodesContainer.children).forEach((btn) => {
                        btn.style.backgroundColor = "#fff";
                        btn.style.color = "#007bff";
                    });

                    document.getElementById("masterLanguage").value = code;
                    updateLocalLanguages();
                };

                button.onmouseover = function () {
                    if (document.getElementById("masterLanguage").value !== code) {
                        button.style.backgroundColor = "#007bff";
                        button.style.color = "#fff";
                    }
                };
                button.onmouseout = function () {
                    if (document.getElementById("masterLanguage").value !== code) {
                        button.style.backgroundColor = "#fff";
                        button.style.color = "#007bff";
                    }
                };
                customMasterCodesContainer.appendChild(button);
            });

            loadSelectToDatalist();

            function createTag(code) {
                const tag = document.createElement("span");
                tag.className = "tag";
                tag.style.backgroundColor = "#e3f2fd";
                tag.style.color = "#1976d2";
                tag.style.padding = "2px 8px";
                tag.style.borderRadius = "16px";
                tag.style.margin = "2px";
                tag.style.display = "inline-flex";
                tag.style.alignItems = "center";
                tag.style.fontSize = "14px";
                tag.textContent = code;

                const removeBtn = document.createElement("button");
                removeBtn.textContent = "√ó";
                removeBtn.style.marginLeft = "4px";
                removeBtn.style.border = "none";
                removeBtn.style.background = "none";
                removeBtn.style.cursor = "pointer";
                removeBtn.style.padding = "0 4px";
                removeBtn.onclick = () => {
                    const idx = selectedTags.indexOf(code);
                    if (idx !== -1) {
                        selectedTags.splice(idx, 1);
                        tag.remove();
                        loadSelectToDatalist();
                        saveSelectedTags();
                        if (selectedTags.length > 0) {
                            const prevTag = selectedTags[idx - 1] || selectedTags[0];
                            const prevButton = Array.from(customMasterCodesContainer.children).find((btn) => btn.textContent === prevTag);

                            if (prevButton) {
                                prevButton.click();
                            }
                        }
                    }

                    const button = Array.from(customMasterCodesContainer.children).find((btn) => btn.textContent === code);
                    if (button) button.remove();
                };

                tag.appendChild(removeBtn);

                return tag;
            }

            masterLanguageInput.addEventListener("change", () => {
                const val = masterLanguageInput.value.trim();
                if (val && !selectedTags.includes(val)) {
                    selectedTags.push(val);
                    const tag = createTag(val);
                    tagsContainer.insertBefore(tag, masterLanguageInput);
                    masterLanguageInput.value = "";
                    loadSelectToDatalist();
                    saveSelectedTags();
                    document.getElementById("masterLanguage").value = val;
                    updateLocalLanguages();
                    const button = document.createElement("button");
                    button.textContent = val;
                    button.style.backgroundColor = "#fff";
                    button.style.border = "1px solid #007bff";
                    button.style.padding = "10px 0.5vw";
                    button.style.color = "#007bff";
                    button.style.borderRadius = "5px";
                    button.style.cursor = "pointer";

                    button.onclick = function () {
                        Array.from(customMasterCodesContainer.children).forEach((btn) => {
                            btn.style.backgroundColor = "#fff";
                            btn.style.color = "#007bff";
                        });

                        document.getElementById("masterLanguage").value = val;
                        updateLocalLanguages();
                    };

                    button.onmouseover = function () {
                        if (document.getElementById("masterLanguage").value !== val) {
                            button.style.backgroundColor = "#007bff";
                            button.style.color = "#fff";
                        }
                    };
                    button.onmouseout = function () {
                        if (document.getElementById("masterLanguage").value !== val) {
                            button.style.backgroundColor = "#fff";
                            button.style.color = "#007bff";
                        }
                    };

                    customMasterCodesContainer.appendChild(button);
                }
                masterLanguageInput.value = "";
            });

            let savedLinksCount = 0;
            function getSelectedInput() {
                return localStorage.getItem("selectedInput") || "";
            }
            function updateSavedLinksCount() {
                const linkCountElement = document.getElementById("linkCount");
                const savedInputs = JSON.parse(localStorage.getItem("savedInputs")) || [];
                const selectedInput = getSelectedInput();
                const checkedIndex = savedInputs.indexOf(selectedInput);
                const checkedPosition = checkedIndex !== -1 ? checkedIndex + 1 : 0;
                linkCountElement.textContent = `${checkedPosition} / ${savedInputs.length}`;
            }
            window.clearRadioSelections = function () {
                const RadioSelections = document.getElementById("savedCustomInputs");
                const container = document.getElementById("radioContainer");
                const clearBtn = document.getElementById("clearSavedLinksBtn");
                const defaultInput = "about-us";
                if (container) {
                    container.innerHTML = "";
                    addSavedInputToDOM(defaultInput, container, true);
                }
                if (RadioSelections) RadioSelections.style.display = "block";
                if (clearBtn) clearBtn.style.display = "block";

                localStorage.setItem("savedInputs", JSON.stringify([defaultInput]));
                localStorage.setItem("selectedInput", defaultInput);

                savedLinksCount = 1;
                updateSavedLinksCount();

                if (typeof links !== "undefined") links.innerHTML = "";
                document.getElementById("customInput").value = defaultInput;
                generateLinks();
            };
            /**
             * Processes a custom input URL and adds it to the saved list
             * - Validates if links were generated for the input
             * - Prevents duplicate entries
             * - Updates UI and localStorage
             * - Enables/disables relevant UI elements
             */
            function processAndAddCustomInput() {
                let input = document.getElementById("customInput").value.trim();
                if (input !== lastGeneratedInput) {
                    alert("Please generate links for this input before saving!");
                    return;
                }
                let savedInputs = JSON.parse(localStorage.getItem("savedInputs")) || [];
                if (savedInputs.length === 1 && savedInputs[0] === "about-us") {
                    savedInputs = [];
                }

                if (savedInputs.includes(input)) return;
                if (input) {
                    savedInputs.push(input);
                    localStorage.setItem("savedInputs", JSON.stringify(savedInputs));
                    saveSelectedInput(input);
                    const container = document.getElementById("radioContainer");
                    if (!container) {
                        alert("Cannot find container to save radio input.");
                        return;
                    }
                    container.innerHTML = "";
                    savedInputs.forEach((savedInput, index) => {
                        addSavedInputToDOM(savedInput, container, index === savedInputs.length - 1);
                    });

                    savedLinksCount = savedInputs.length;
                    updateSavedLinksCount();
                    document.getElementById("customInput").value = input;
                    masterLanguage.disabled = false;
                    const clearBtn = document.getElementById("clearSavedLinksBtn");
                    if (clearBtn) clearBtn.style.display = "block";
                    showOnlyDeleteButtonFor(input);
                    const savedBox = document.getElementById("savedCustomInputs");
                    if (savedBox && (savedBox.style.display === "none" || savedBox.style.display === "")) {
                        savedBox.style.display = "block";
                    }
                }
            }
            /**
             * Adds a saved input as a radio button to the DOM
             * @param {string} input - The URL to add
             * @param {HTMLElement} container - The container element for radio buttons
             * @param {boolean} checked - Whether this radio should be checked
             *
             * Creates:
             * - Radio button with label
             * - Delete button (hidden by default)
             * - Adds event listeners for selection and deletion
             */
            function addSavedInputToDOM(input, container, checked = false) {
                const div = document.createElement("div");
                div.style.display = "flex";
                div.style.alignItems = "center";
                div.style.justifyContent = "space-between";
                div.style.position = "relative";
                div.style.paddingRight = "20px";
                const label = document.createElement("label");
                label.style.flex = "1";
                const radio = document.createElement("input");
                radio.type = "radio";
                radio.name = "savedInput";
                radio.value = input;
                radio.checked = checked;
                radio.onchange = function () {
                    saveSelectedInput(radio.value);
                    updateSavedLinksCount();
                    updateCustomInput(radio);
                    showOnlyDeleteButtonFor(radio.value);
                    saveSelectedInput(radio.value);
                };
                label.appendChild(radio);
                label.append(` ${input}`);
                const deleteBtn = document.createElement("button");
                deleteBtn.innerText = "‚ùå";
                deleteBtn.onclick = () => deleteSavedInput(input);
                deleteBtn.style.marginLeft = "10px";
                deleteBtn.style.background = "none";
                deleteBtn.style.border = "none";
                deleteBtn.style.color = "red";
                deleteBtn.style.cursor = "pointer";
                deleteBtn.style.display = "none";
                deleteBtn.style.position = "absolute";
                deleteBtn.style.top = "0";
                deleteBtn.style.right = "0";
                deleteBtn.className = "delete-btn";
                div.appendChild(label);
                div.appendChild(deleteBtn);
                container.appendChild(div);
                const allDivs = container.querySelectorAll("div");
                allDivs.forEach((el, index) => {
                    el.style.paddingBottom = index === allDivs.length - 1 ? "0px" : "10px";
                });
            }
            /**
             * Loads saved inputs from localStorage and recreates the radio buttons
             * - Clears existing radio buttons
             * - Loads saved inputs from localStorage
             * - Recreates radio buttons with correct checked states
             * - Shows "No saved inputs" message if none exist
             */
            function loadSavedInputsFromStorage() {
                const container = document.getElementById("radioContainer");
                if (!container) return;
                container.innerHTML = "";
                let savedInputs = JSON.parse(localStorage.getItem("savedInputs") || "[]");
                if (savedInputs.length === 0) {
                    container.innerHTML = "<p>No saved inputs found.</p>";
                    return;
                }
                const selectedInput = localStorage.getItem("selectedInput") || "";
                savedInputs.forEach((input) => {
                    const isChecked = input === selectedInput;
                    addSavedInputToDOM(input, container, isChecked);
                });
            }
            /**
             * Updates the custom input field when a radio button is selected
             * @param {HTMLInputElement} radio - The selected radio button
             *
             * - Updates custom input value
             * - Regenerates links if needed
             * - Updates UI state (delete button visibility)
             * - Saves selection to localStorage
             * - No longer adds new radio buttons to prevent duplicates
             */
            function updateCustomInput(radio) {
                const input = document.getElementById("customInput");
                input.value = radio.value;
                if (input.value !== lastGeneratedInput) {
                    generateLinks();
                }
                showOnlyDeleteButtonFor(radio.value);
                setTimeout(() => {
                    if (radio.value !== input.value) {
                        radio.value = input.value;
                    }
                }, 0);
                let savedInputs = JSON.parse(localStorage.getItem("savedInputs")) || [];
                const index = savedInputs.indexOf(radio.value);
                if (index === -1) {
                    savedInputs.push(radio.value);
                } else {
                    savedInputs[index] = radio.value;
                }
                localStorage.setItem("savedInputs", JSON.stringify(savedInputs));
                saveSelectedInput(radio.value);
            }
            function showOnlyDeleteButtonFor(selectedValue) {
                const container = document.getElementById("radioContainer");
                const divs = container.querySelectorAll("div");
                divs.forEach((div) => {
                    const radio = div.querySelector('input[type="radio"]');
                    const btn = div.querySelector(".delete-btn");
                    if (radio && btn) {
                        btn.style.display = radio.value === selectedValue && radio.checked ? "inline" : "none";
                    }
                });
            }
            window.deleteSavedInput = function (value) {
                if (value === "about-us" && JSON.parse(localStorage.getItem("savedInputs") || "[]").length === 1) {
                    alert("Cannot delete the default 'about-us' link!");
                    return;
                }

                let savedInputs = JSON.parse(localStorage.getItem("savedInputs")) || [];
                const indexToRemove = savedInputs.indexOf(value);
                const isCurrentSelected = getSelectedInput() === value;
                if (savedInputs.length === 1 && value !== "about-us") {
                    const defaultInput = "about-us";
                    savedInputs = [defaultInput];
                    localStorage.setItem("savedInputs", JSON.stringify(savedInputs));
                    localStorage.setItem("selectedInput", defaultInput);

                    const container = document.getElementById("radioContainer");
                    container.innerHTML = "";
                    addSavedInputToDOM(defaultInput, container, true);

                    document.getElementById("customInput").value = defaultInput;
                    document.getElementById("masterLanguage").disabled = false;
                    document.getElementById("clearSavedLinksBtn").style.display = "block";
                    document.getElementById("links").innerHTML = "";

                    savedLinksCount = 1;
                    updateSavedLinksCount();
                    generateLinks();
                    return;
                }
                savedInputs = savedInputs.filter((input) => input !== value);
                localStorage.setItem("savedInputs", JSON.stringify(savedInputs));
                const container = document.getElementById("radioContainer");
                container.innerHTML = "";

                let newSelectedInput = getSelectedInput();
                if (isCurrentSelected) {
                    if (savedInputs.length > 0) {
                        const newIndex = Math.max(0, indexToRemove - 1);
                        newSelectedInput = savedInputs[newIndex];
                        saveSelectedInput(newSelectedInput);
                    } else {
                        newSelectedInput = "";
                        localStorage.removeItem("selectedInput");
                    }
                }

                savedLinksCount--;
                updateSavedLinksCount();
                savedInputs.forEach((input) => {
                    const isChecked = input === newSelectedInput;
                    addSavedInputToDOM(input, container, isChecked);
                });

                if (savedInputs.length === 0) {
                    container.style.display = "none";
                    document.getElementById("clearSavedLinksBtn").style.display = "none";
                    document.getElementById("masterLanguage").disabled = true;
                    document.getElementById("customInput").value = "";
                } else {
                    document.getElementById("customInput").value = newSelectedInput;
                    generateLinks();
                    showOnlyDeleteButtonFor(newSelectedInput);
                    document.getElementById("masterLanguage").disabled = false;
                    document.getElementById("clearSavedLinksBtn").style.display = "block";
                }
            };
            window.onload = function () {
                const savedInputs = JSON.parse(localStorage.getItem("savedInputs")) || [];
                savedLinksCount = savedInputs.length;
                updateSavedLinksCount();
                const selected = getSelectedInput();
                const container = document.getElementById("radioContainer");
                const masterLanguage = document.getElementById("masterLanguage");
                const clearBtn = document.getElementById("clearSavedLinksBtn");
                if (savedInputs.length > 0) {
                    masterLanguage.disabled = false;
                    savedInputs.forEach((input) => {
                        addSavedInputToDOM(input, container, input === selected);
                    });
                    const input = selected || savedInputs[savedInputs.length - 1];
                    document.getElementById("customInput").value = input;
                    generateLinks();
                    clearBtn.style.display = "block";
                    showOnlyDeleteButtonFor(input);
                } else {
                    masterLanguage.disabled = true;
                    clearBtn.style.display = "none";
                }
                const panel = document.getElementById("languageSection");
                if (panel) {
                    panel.classList.add("show");
                }
                initializeCheckboxes();
            };
            function generateLinksFromInput(input) {
                return input.split("?")[0];
            }
            document.getElementById("customInput").addEventListener("input", function () {
                let inputValue = this.value;
                if (inputValue.startsWith("/")) {
                    inputValue = inputValue.substring(1);
                }
                const baseUrls = ["https://author-grundfos-prod-65.adobecqms.net/", "https://www.grundfos.com/", "https://product-selection.grundfos.com/"];
                const customUrl = "https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/language-masters/en-GB/";
                let isValid = baseUrls.some((url) => inputValue.startsWith(url));
                let finalUrl = isValid || inputValue.startsWith(customUrl) ? inputValue : customUrl + inputValue;
                console.log("Final URL:", finalUrl);
            });
            const openModalButton = document.getElementById("openModalButton");
            const modal = document.getElementById("modal");
            const closeModalButton = document.getElementById("closeModalButton");
            openModalButton.onclick = function () {
                modal.style.display = "block";
            };
            closeModalButton.onclick = function () {
                modal.style.display = "none";
            };
            window.onclick = function (event) {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            };
            function toggleSearchInput() {
                const searchContainer = document.getElementById("searchContainer");
                const button = document.getElementById("toggleSearchButton");
                if (searchContainer.style.display === "none") {
                    searchContainer.style.display = "block";
                    button.textContent = "Hide Search Input";
                } else {
                    searchContainer.style.display = "none";
                    button.textContent = "Show Search Input";
                }
            }
            function handleInputSearch() {
                const searchInput = document.getElementById("searchInput").value.toUpperCase().trim();
                document.getElementById("masterLanguageInfo").textContent = "Master Language: ";
                document.getElementById("localLanguagesInfo").textContent = "Local Languages: ";
                if (languageMapping[searchInput]) {
                    const localLang = languageMapping[searchInput][0];
                    let found = false;
                    for (const masterLang in localLanguages) {
                        if (localLanguages[masterLang].includes(localLang)) {
                            document.getElementById("masterLanguageInfo").textContent = "Master Language: " + masterLang;
                            document.getElementById("localLanguagesInfo").textContent = "Local Languages: " + localLang;
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        document.getElementById("masterLanguageInfo").textContent = "Master Language: Not Found";
                        document.getElementById("localLanguagesInfo").textContent = "Local Languages: Not Found";
                    }
                } else {
                    document.getElementById("masterLanguageInfo").textContent = "Master Language: Not Found";
                    document.getElementById("localLanguagesInfo").textContent = "Local Languages: Not Found";
                }
            }
            function applySearchInput() {
                const searchInput = document.getElementById("searchInput").value.toUpperCase().trim();
                const customInput = document.getElementById("customInput").value.trim();
                if (!customInput) {
                    alert("Please enter data into the customInput before proceeding.");
                    return;
                }
                if (!searchInput) {
                    alert("Please enter data into the Search Language before proceeding.");
                    return;
                }
                if (languageMapping[searchInput]) {
                    const localLang = languageMapping[searchInput][0];
                    let found = false;
                    for (const masterLang in localLanguages) {
                        if (localLanguages[masterLang].includes(localLang)) {
                            const masterSelect = document.getElementById("masterLanguage");
                            const options = masterSelect.getElementsByTagName("option");
                            for (let option of options) {
                                if (option.value === masterLang) {
                                    option.selected = true;
                                    break;
                                }
                            }
                            updateLocalLanguages1(localLanguages[masterLang]);
                            const localCheckboxToSelect = document.querySelector(`#localLanguages input[type="checkbox"][value="${localLang}"]`);
                            if (localCheckboxToSelect) {
                                localCheckboxToSelect.checked = true;
                            }
                            generateLinks();
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        document.getElementById("masterLanguage").selectedIndex = 0;
                        document.getElementById("localLanguages").innerHTML = "";
                        const localCheckboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                        localCheckboxes.forEach((checkbox) => (checkbox.checked = false));
                    }
                } else {
                    document.getElementById("masterLanguage").selectedIndex = 0;
                    document.getElementById("localLanguages").innerHTML = "";
                    const localCheckboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                    localCheckboxes.forEach((checkbox) => (checkbox.checked = false));
                }
            }
            /**
             * Analyzes the input URL and suggests appropriate language settings
             *
             * Supports multiple URL formats:
             * - Direct website URLs (www.grundfos.com/xx)
             * - Language master URLs (/content/grundfos/language-masters/xx-XX)
             * - Local language URLs (/content/grundfos/xx/yy)
             *
             * Updates:
             * - Master language selection
             * - Local language checkboxes
             * - Generates appropriate links based on selected languages
             */
            function generateLanguageSuggestions() {
                const inputURL = document.getElementById("customInput").value.trim();
                const masterSelect = document.getElementById("masterLanguage");
                if (!inputURL) {
                    alert("Please provide a valid URL.");
                    return;
                }
                const languagePattern = /https:\/\/(?:www|product-selection)\.grundfos\.com\/([a-z]{2})\//;
                const languageMastersPattern = /.*?\/content\/grundfos\/language-masters\/([a-z]{2}-[A-Z]{2})/;
                const nonLanguageMastersPattern = /.*?\/content\/grundfos\/([a-z]{2})\/([a-z]{2})\//;
                let languageCode = null;
                const matchLanguage = inputURL.match(languagePattern);
                if (matchLanguage) {
                    languageCode = matchLanguage[1];
                } else if (inputURL.match(languageMastersPattern)) {
                    const matchLanguageMasters = inputURL.match(languageMastersPattern);
                    languageCode = matchLanguageMasters[1];
                    if (languageCode) {
                        masterSelect.value = languageCode;
                        updateLocalLanguages([]);
                        return;
                    }
                } else {
                    const matchNonLanguageMasters = inputURL.match(nonLanguageMastersPattern);
                    if (matchNonLanguageMasters) {
                        const countryCode = matchNonLanguageMasters[1];
                        const languageCodeSuffix = matchNonLanguageMasters[2];
                        for (const [master, locals] of Object.entries(localLanguages)) {
                            const languageCode = `${countryCode}/${languageCodeSuffix}`;
                            if (locals.includes(languageCode)) {
                                masterSelect.value = master;
                                updateLocalLanguages([]);
                                return;
                            }
                        }
                    } else {
                        languageCode = "www/en";
                        masterSelect.value = "en-GB";
                        updateLocalLanguages([]);
                    }
                }
                if (!languageCode) {
                    alert("Can't find your language code in the URL!");
                    return;
                }
                let matchedLocals = [];
                let fullMatchFound = false;
                for (const [master, locals] of Object.entries(localLanguages)) {
                    const localMatches = locals.filter((local) => local.startsWith(languageCode + "/"));
                    if (localMatches.length > 0) {
                        matchedLocals = matchedLocals.concat(localMatches);
                    }
                }
                let prioritizedLocals = matchedLocals.filter((local) => local === `${languageCode}/${languageCode}`);
                if (prioritizedLocals.length === 0) {
                    prioritizedLocals = matchedLocals.sort((a, b) => {
                        if (a.includes("/nl") && !b.includes("/nl")) return -1;
                        if (a.includes("/fr") && !b.includes("/fr")) return -1;
                        return 0;
                    });
                }
                let prioritizedMasters = [];
                for (let i = 0; i < prioritizedLocals.length; i++) {
                    const local = prioritizedLocals[i];
                    for (const [master, locals] of Object.entries(localLanguages)) {
                        if (locals.includes(local)) {
                            if (!prioritizedMasters.includes(master)) {
                                prioritizedMasters.push(master);
                            }
                            break;
                        }
                    }
                }
                let sortedMasters = prioritizedMasters.sort((a, b) => {
                    if (a === "nl-NL" && b !== "nl-NL") return -1;
                    if (b === "nl-NL" && a !== "nl-NL") return 1;
                    if (a === "en-US" && b !== "en-US") return -1;
                    if (b === "en-US" && a !== "en-US") return 1;
                    if (a === "de-DE" && b !== "de-DE") return -1;
                    if (b === "de-DE" && a !== "de-DE") return 1;
                    if (a === "fr-FR" && b !== "fr-FR") return -1;
                    if (b === "fr-FR" && a !== "fr-FR") return 1;
                    return 0;
                });
                if (prioritizedMasters.length > 0) {
                    const selectedMaster = sortedMasters[0];
                    masterSelect.value = selectedMaster;
                    updateLocalLanguages(prioritizedLocals);
                    generateLinksForCondition3();
                    generateLinks();
                }
            }
            function updateLocalLanguages() {
                const masterLanguage = document.getElementById("masterLanguage").value;
                const localLanguagesDiv = document.getElementById("localLanguages");
                localLanguagesDiv.innerHTML = "";
                if (localLanguages[masterLanguage]) {
                    localLanguages[masterLanguage].forEach((code, index) => {
                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.id = code;
                        checkbox.value = code;
                        checkbox.onchange = handleLocalLanguageChange;
                        const label = document.createElement("label");
                        label.setAttribute("for", code);
                        label.textContent = code;
                        localLanguagesDiv.appendChild(checkbox);
                        localLanguagesDiv.appendChild(label);
                        localLanguagesDiv.appendChild(document.createElement("br"));
                        const savedStates = JSON.parse(localStorage.getItem("checkboxStates")) || [];
                        const savedState = savedStates.find((state) => state.id === code);
                        if (savedState) {
                            checkbox.checked = savedState.checked;
                            checkbox.disabled = savedState.disabled;
                        }
                        if (index === 0 && !savedState) {
                            checkbox.checked = true;
                            checkbox.dispatchEvent(new Event("change"));
                        }
                    });
                }
                applyDisabledStyles();
            }
            function updateLocalLanguages1() {
                const masterLanguage = document.getElementById("masterLanguage").value;
                const localLanguagesDiv = document.getElementById("localLanguages");
                localLanguagesDiv.innerHTML = "";
                if (localLanguages[masterLanguage]) {
                    localLanguages[masterLanguage].forEach((code, index) => {
                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.id = code;
                        checkbox.value = code;
                        checkbox.onchange = handleLocalLanguageChange;
                        const label = document.createElement("label");
                        label.setAttribute("for", code);
                        label.textContent = code;
                        localLanguagesDiv.appendChild(checkbox);
                        localLanguagesDiv.appendChild(label);
                        localLanguagesDiv.appendChild(document.createElement("br"));
                        const savedStates = JSON.parse(localStorage.getItem("checkboxStates")) || [];
                        const savedState = savedStates.find((state) => state.id === code);
                        if (savedState) {
                            checkbox.checked = savedState.checked;
                            checkbox.disabled = savedState.disabled;
                        }
                    });
                }
                applyDisabledStyles();
            }
            function applyDisabledStyles() {
                const checkboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                checkboxes.forEach((checkbox) => {
                    const label = checkbox.nextElementSibling;
                    if (checkbox.disabled) {
                        label.style.opacity = "0.5";
                        label.style.pointerEvents = "none";
                    } else {
                        label.style.opacity = "1";
                        label.style.pointerEvents = "auto";
                    }
                });
            }
            function handleLocalLanguageChange() {
                const checkboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                const firstCheckbox = checkboxes[0];
                const checkboxStates = Array.from(checkboxes).map((checkbox) => ({
                    id: checkbox.id,
                    checked: checkbox.checked,
                    disabled: checkbox.disabled,
                }));
                localStorage.setItem("checkboxStates", JSON.stringify(checkboxStates));
                if (firstCheckbox.checked) {
                    checkboxes.forEach((checkbox, index) => {
                        if (index > 0) {
                            checkbox.disabled = true;
                            checkbox.checked = false;
                        }
                    });
                } else {
                    checkboxes.forEach((checkbox, index) => {
                        if (index > 0) {
                            checkbox.disabled = false;
                        }
                    });
                }
                applyDisabledStyles();
                const selectedLocalLanguages = Array.from(document.querySelectorAll('#localLanguages input[type="checkbox"]:checked')).map((checkbox) => checkbox.value);
                currentLocalLanguages = selectedLocalLanguages;
                generateLinksForCondition3();
                generateLinks();
            }
            function initializeCheckboxes() {
                const checkboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                const savedStates = JSON.parse(localStorage.getItem("checkboxStates")) || [];
                checkboxes.forEach((checkbox) => {
                    const savedState = savedStates.find((state) => state.id === checkbox.id);
                    if (savedState) {
                        checkbox.checked = savedState.checked;
                        checkbox.disabled = savedState.disabled;
                    }
                });
                const firstCheckbox = checkboxes[0];
                if (firstCheckbox.checked) {
                    checkboxes.forEach((checkbox, index) => {
                        if (index > 0) {
                            checkbox.disabled = true;
                            checkbox.checked = false;
                        }
                    });
                }
                applyDisabledStyles();
            }
            function removeDuplicateLinks(linksDiv) {
                const linkElements = linksDiv.querySelectorAll("p a");
                const seenURLs = new Set();
                const paragraphs = Array.from(linksDiv.getElementsByTagName("p")).sort((a, b) => {
                    const textA = a.textContent.trim().toLowerCase();
                    const textB = b.textContent.trim().toLowerCase();
                });
                paragraphs.forEach((p) => linksDiv.appendChild(p));
                linkElements.forEach((linkElement) => {
                    const url = linkElement.href.trim();
                    if (seenURLs.has(url)) {
                        const parentParagraph = linkElement.closest("p");
                        if (parentParagraph) {
                            parentParagraph.remove();
                        }
                    } else {
                        seenURLs.add(url);
                    }
                });
            }
            function generateLinks() {
                const masterLanguage = document.getElementById("masterLanguage").value;
                const customInputEl = document.getElementById("customInput");
                const fragmentInput = document.getElementById("fragmentInput").value;
                const linksDiv = document.getElementById("links");
                const fragmentContainer = document.getElementById("fragmentContainer");

                const conditions = Array.from(document.querySelectorAll('input[name="condition"]:checked')).map((cb) => cb.value);
                const checkboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]:checked');
                const localLanguagesChecked = Array.from(checkboxes).map((cb) => cb.value);
                linksDiv.innerHTML = "";
                if (!conditions.includes("radio3")) {
                    fragmentContainer.innerHTML = "";
                }
                let input = customInputEl.value.trim();
                let result = extractPathFromUrl(input);
                result = cleanUpPath(result);
                customInputEl.value = result;
                lastGeneratedInput = result;
                conditions.forEach((condition) => {
                    switch (condition) {
                        case "radio1":
                            generateLinksForCondition1(masterLanguage, localLanguagesChecked, result, linksDiv);
                            break;
                        case "radio3":
                            generateLinksForCondition3();
                            break;
                        case "radio4":
                            generateLinksForCondition4(masterLanguage, localLanguagesChecked, fragmentInput, linksDiv);
                            break;
                    }
                });
                console.log("Generated input:", lastGeneratedInput);
            }
            document.querySelectorAll('input[name="condition"]').forEach((cb) => {
                cb.addEventListener("change", () => {
                    generateLinks();
                });
            });
            function extractPathFromUrl(url) {
                const mappings = [
                    { old: "products", new: "solutions" },
                    { old: "learn", new: "solutions/learn" },
                    { old: "support", new: "solutions/support" },
                    { old: "about-us/sustainability", new: "sustainability" },
                    { old: "about-us/media", new: "media" },
                    { old: "about-us/careers", new: "careers" },
                ];
                url = url.split("?")[0];
                const lmIndex = url.indexOf("language-masters/");
                if (lmIndex !== -1) {
                    let path = url.substring(lmIndex + "language-masters/".length);
                    const firstSlashIndex = path.indexOf("/");
                    return firstSlashIndex !== -1 ? path.substring(firstSlashIndex + 1) : path;
                }
                const grundfosMatch = url.match(/^.*grundfos\/([^/]+\/[^/]+\/.*)/);
                if (grundfosMatch) {
                    let path = grundfosMatch[1];
                    if (url.includes("www/en")) {
                        mappings.forEach(({ old, new: n }) => {
                            if (!(path.includes("solutions/learn/") && old === "products")) {
                                if (path.includes(old)) path = path.replace(old, n);
                            }
                        });
                    } else {
                        mappings.forEach(({ old, new: n }) => {
                            if (!(path.includes("solutions/learn/") && old === "products")) {
                                if (path.includes(n)) path = path.replace(n, old);
                            }
                        });
                    }
                    return path;
                }
                const domainPattern = /https:\/\/(www|product-selection)\.grundfos\.com\/([a-z]{2})\//;
                const match = url.match(domainPattern);
                if (match) {
                    const regionCode = match[2];
                    const regionIndex = url.indexOf(regionCode) + regionCode.length + 1;
                    let path = url.substring(regionIndex);
                    if (url.includes("product-selection")) {
                        path = "products/" + path;
                    }
                    return path;
                }
                let baseIndex = url.indexOf("www.grundfos.com/") !== -1 ? url.indexOf("www.grundfos.com/") : url.indexOf("product-selection.grundfos.com/");
                if (baseIndex !== -1) {
                    let path = url.substring(baseIndex + (url.indexOf("www.grundfos.com/") !== -1 ? "www.grundfos.com/".length : "product-selection.grundfos.com/".length));
                    if (url.includes("product-selection.grundfos.com/")) {
                        path = "products/" + path;
                    }
                    mappings.forEach(({ old, new: n }) => {
                        if (!(path.includes("solutions/learn/") && old === "products")) {
                            if (path.includes(n)) path = path.replace(n, old);
                        }
                    });
                    return path;
                }
                return url;
            }
            function cleanUpPath(path) {
                if (path.endsWith(".html")) path = path.slice(0, -5);
                if (path.endsWith("/")) path = path.slice(0, -1);
                if (path.startsWith("/")) path = path.slice(1);
                return path;
            }
            function generateAdditionalLinks(masterLanguage, localLanguage, customInput, localLanguages, liveSiteLanguage, linksDiv) {
                let linksHTML = "";
                let result = "";
                let baseUrl = customInput;
                if (typeof customInput !== "string") {
                    return;
                }
                const questionMarkIndex = customInput.indexOf("?");
                if (questionMarkIndex !== -1) {
                    baseUrl = customInput.substring(0, questionMarkIndex);
                }
                const baseIndex = baseUrl.indexOf("language-masters/");
                if (baseIndex !== -1) {
                    baseUrl = baseUrl.substring(baseIndex + "language-masters/".length);
                    const firstSlashIndex = baseUrl.indexOf("/");
                    if (firstSlashIndex !== -1) {
                        result = baseUrl.substring(firstSlashIndex + 1);
                    } else {
                        result = baseUrl;
                    }
                    if (result.endsWith(".html")) {
                        result = result.slice(0, -5);
                    }
                    if (result.endsWith("/")) {
                        result = result.slice(0, -1);
                    }
                    if (result.startsWith("/")) {
                        result = result.slice(1);
                    }
                }
                const replacements = [
                    {
                        old: "products",
                        new: "solutions",
                    },
                    {
                        old: "learn",
                        new: "solutions/learn",
                    },
                    {
                        old: "support",
                        new: "solutions/support",
                    },
                    {
                        old: "about-us/sustainability",
                        new: "sustainability",
                    },
                    {
                        old: "about-us/media",
                        new: "media",
                    },
                    {
                        old: "about-us/careers",
                        new: "careers",
                    },
                ];
                const linkMapping = {
                    "products/industries": "https://www.grundfos.com/solutions/industries",
                    "products/applications": "https://product-selection.grundfos.com/applications",
                    "products/categories": "https://product-selection.grundfos.com/categories",
                    "products/pumped-liquid-guide": "https://product-selection.grundfos.com/pumped-liquid-guide",
                    "products/products": "https://product-selection.grundfos.com/products",
                    products: "https://product-selection.grundfos.com/",
                    "solutions/learn": "https://www.grundfos.com/solutions/learn",
                    support: "https://www.grundfos.com/solutions/support",
                    "about-us/sustainability": "https://www.grundfos.com/sustainability",
                    "about-us/media": "https://www.grundfos.com/media",
                    "about-us/careers": "https://www.grundfos.com/careers",
                };
                if (!baseUrl || baseUrl === "undefined") {
                    return;
                }
                let linkBase = baseUrl;
                const checkboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]:checked');
                const localLanguagesChecked = Array.from(checkboxes).map((checkbox) => checkbox.value);
                if (!Array.isArray(localLanguagesChecked)) {
                    localLanguagesChecked = [];
                }
                const localLanguagesList = localLanguages[masterLanguage] || [];
                if (localLanguagesChecked.includes(masterLanguage)) {
                    const remainingLanguages = localLanguagesList.filter((lang) => lang !== masterLanguage);
                    let masterLanguageExists = false;
                    let localLanguageExists = false;
                    linksDiv.querySelectorAll("p").forEach((p) => {
                        if (p.querySelector("strong") && p.querySelector("strong").textContent.includes(`Master Language Selected (${masterLanguage})`)) {
                            masterLanguageExists = true;
                        }
                    });
                    if (!masterLanguageExists) {
                        if (remainingLanguages.length > 0) {
                            linksHTML += `<p><br><br><strong>Master Language Selected (${masterLanguage}):</strong> ${remainingLanguages.join(", ")}</p>`;
                        } else {
                            linksHTML += `<p><strong>Master Language Selected (${masterLanguage}):</strong> No additional locales available to display.</p>`;
                        }
                    }
                    remainingLanguages.forEach((language) => {
                        const localLinkEditorLocal = `https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${language}/${linkBase}`;
                        const localLinkSitesLocal = `https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${language}/${linkBase}`;
                        const localLinkDisabledLocal = `https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${language}/${linkBase}?wcmmode=disabled`;
                        const localpublishLinks = `https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${language}${linkBase}`;
                        linksDiv.querySelectorAll("p").forEach((p) => {
                            if (p.querySelector("strong") && p.querySelector("strong").textContent.includes(`Local Language (${language})`)) {
                                localLanguageExists = true;
                            }
                        });
                        if (!localLanguageExists) {
                            linksHTML += `<p><strong>Local Language (${language}):</strong></p>`;
                        }
                        if (language === "www/en") {
                            let liveSiteLink = `https://www.grundfos.com/${baseUrl}`.replace(/\/{2,}/g, "/");
                            let modifiedLinkBase = linkBase;
                            replacements.forEach((replacement) => {
                                if (modifiedLinkBase.includes(replacement.old)) {
                                    modifiedLinkBase = modifiedLinkBase.replace(replacement.old, replacement.new);
                                }
                            });
                            linksHTML += `<p>Site Live: <a href="https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/www/en/${modifiedLinkBase}" class="liveSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/www/en/${modifiedLinkBase}</a></p>
                                    <p>Editor: <a href="https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/www/en/${modifiedLinkBase}" class="editSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/www/en/${modifiedLinkBase}</a></p>
                                    <p>Publish: <a href="https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/www/en/${modifiedLinkBase}" class="pulishSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/www/en/${modifiedLinkBase}</a></p>
                                    <p>Preview: <a href="https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/www/en/${modifiedLinkBase}?wcmmode=disabled" class="previewSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/www/en/${modifiedLinkBase}?wcmmode=disabled</a></p>`;
                            const originalLinkBase = linkBase;
                            let finalLink = null;
                            for (let key in linkMapping) {
                                if (linkMapping.hasOwnProperty(key) && originalLinkBase.includes(key)) {
                                    finalLink = originalLinkBase.replace(key, linkMapping[key]);
                                    break;
                                }
                            }
                            if (!finalLink) {
                                finalLink = `https://www.grundfos.com/${originalLinkBase}`;
                            }
                            linksHTML += `<p>Live Site Link: <a href="${finalLink}" target="_blank">${finalLink}</a></p>`;
                        } else {
                            let modifiedLinkBase = linkBase;
                            const localePrefix = language.split("/")[0];
                            const localeSuffix = language.split("/")[1];
                            const liveLink = `https://www.grundfos.com/${language.split("/")[0]}/${baseUrl}`;
                            let newLink = `https://www.grundfos.com/${baseUrl}`;
                            if (["ch/fr", "be/fr", "ca/fr"].includes(language)) {
                                newLink = `https://www.grundfos.com/${language}/${baseUrl}`;
                            } else {
                                newLink = `https://www.grundfos.com/${localePrefix}/${baseUrl}`;
                            }
                            if (newLink.includes("/products")) {
                                let originalLink = newLink;
                                if (originalLink.includes("https://www.grundfos.com/")) {
                                    newLink = originalLink.replace("https://www.grundfos.com/", "https://product-selection.grundfos.com/").replace("/products", "");
                                }
                                if (originalLink.includes("https://www.grundfos.com/cn/")) {
                                    newLink = originalLink.replace("https://www.grundfos.com/cn/", "https://product-selection.grundfos.cn/").replace("/products", "");
                                }
                                newLink = newLink.replace("/www/", "/");
                                newLink = newLink.replace("/gb/", "/uk/");
                                linksHTML += `<p>Site Live: <a href="${localLinkSitesLocal}" class="liveSiteLocal" target="_blank">${localLinkSitesLocal}</a></p>`;
                                linksHTML += `<p>Editor: <a href="${localLinkEditorLocal}" class="editSiteLocal" target="_blank">${localLinkEditorLocal}</a></p>`;
                                linksHTML += `<p>Publish: <a href="${localpublishLinks}" class="pulishSiteLocal" target="_blank">${localpublishLinks}</a></p>`;
                                linksHTML += `<p>Preview: <a href="${localLinkDisabledLocal}" class="previewSiteLocal" target="_blank">${localLinkDisabledLocal}</a></p>`;
                                linksHTML += `<p>Live Site Link: <a href="${newLink}" class="liveSiteLink"  target="_blank">${newLink}</a><br></p>`;
                            } else if (newLink.includes("solutions/learn")) {
                                newLink = newLink.replace("solutions/learn", "learn");
                                let updatedLinkBase = linkBase;
                                updatedLinkBase = updatedLinkBase.replace("solutions/learn", "learn");
                                linksHTML += `<p>Site Live: <a href="https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${language}/${updatedLinkBase}" class="liveSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${language}/${updatedLinkBase}</a></p>
                                    <p>Editor: <a href="https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${language}/${updatedLinkBase}" class="editSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${language}/${updatedLinkBase}</a></p>
                                    <p>Publish: <a href="https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${language}/${updatedLinkBase}" class="pulishSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${language}/${updatedLinkBase}</a></p>
                                    <p>Preview: <a href="https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${language}/${updatedLinkBase}?wcmmode=disabled" class="previewSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${language}/${updatedLinkBase}?wcmmode=disabled</a></p>`;
                                linksHTML += `<p>Live Site Link: <a href="${newLink}" class="liveSiteLink" target="_blank">${newLink}</a><br></p>`;
                            } else {
                                let originalLink = newLink;
                                if (originalLink.includes("https://www.grundfos.com/cn/")) {
                                    newLink = originalLink.replace("https://www.grundfos.com/cn/", "Https://www.grundfos.cn/").replace("/products", "");
                                }
                                newLink = newLink.replace("/www/", "/");
                                newLink = newLink.replace("/gb/", "/uk/");
                                linksHTML += `<p>Site Live: <a href="https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${language}/${modifiedLinkBase}" class="liveSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${language}/${modifiedLinkBase}</a></p>
                                    <p>Editor: <a href="https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${language}/${modifiedLinkBase}" class="editSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${language}/${modifiedLinkBase}</a></p>
                                    <p>Publish: <a href="https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${language}/${modifiedLinkBase}"  class="pulishSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${language}/${modifiedLinkBase}</a></p>
                                    <p>Preview: <a href="https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${language}/${modifiedLinkBase}?wcmmode=disabled" lass="previewSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${language}/${modifiedLinkBase}?wcmmode=disabled</a></p>`;
                                linksHTML += `<p>Live Site Link: <a href="${newLink}" class="liveSiteLink" target="_blank">${newLink}</a><br></p>`;
                            }
                        }
                    });
                } else if (localLanguagesChecked.length > 0) {
                    let addedSelectedLanguages = false;
                    const selectedLanguagesCount = Array.from(linksDiv.querySelectorAll("p")).filter((p) => p.innerHTML.includes("Selected Local Languages:")).length;
                    if (selectedLanguagesCount === 0) {
                        const selectedLanguagesText = `<p><strong><br><br>Selected Local Languages:</strong> ${localLanguagesChecked.join(", ")}</p>`;
                        linksHTML += selectedLanguagesText;
                    }
                    linksDiv.querySelectorAll("p").forEach((p) => {
                        if (p.querySelector("strong") && p.querySelector("strong").textContent.includes(`Selected Local Languages:</strong> ${localLanguagesChecked.join(", ")}`)) {
                            localLanguageExists = true;
                        }
                    });
                    localLanguagesChecked.forEach((selectedLocalLanguage) => {
                        const localLinkEditorLocal = `https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${selectedLocalLanguage}/${linkBase}`;
                        const localLinkSitesLocal = `https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${selectedLocalLanguage}/${linkBase}`;
                        const localpublishLinks = `https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${selectedLocalLanguage}/${linkBase}`;
                        const localLinkDisabledLocal = `https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${selectedLocalLanguage}/${linkBase}?wcmmode=disabled`;
                        let localLanguageExists = false;
                        linksDiv.querySelectorAll("p").forEach((p) => {
                            if (p.querySelector("strong") && p.querySelector("strong").textContent.includes(`Local Language (${selectedLocalLanguage})`)) {
                                localLanguageExists = true;
                            }
                        });
                        if (!localLanguageExists) {
                            linksHTML += `<p><strong>Local Language (${selectedLocalLanguage}):</strong></p>`;
                        }
                        if (selectedLocalLanguage === "www/en") {
                            let liveSiteLink = `https://www.grundfos.com/${baseUrl}`.replace(/\/{2,}/g, "/");
                            let updatedLinkBase = linkBase;
                            let modifiedLinkBase = updatedLinkBase;
                            replacements.forEach((replacement) => {
                                if (modifiedLinkBase.includes(replacement.old)) {
                                    modifiedLinkBase = modifiedLinkBase.replace(replacement.old, replacement.new);
                                }
                            });
                            linksHTML += `<p>Site Live: <a href="https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/www/en/${modifiedLinkBase}" class="liveSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/www/en/${modifiedLinkBase}</a></p>
                                    <p>Editor: <a href="https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/www/en/${modifiedLinkBase}" class="editSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/www/en/${modifiedLinkBase}</a></p>
                                    <p>Publish: <a href="https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/www/en/${modifiedLinkBase}" class="pulishSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/www/en/${modifiedLinkBase}</a></p>
                                    <p>Preview: <a href="https://author-grundfos-prod-65.adobecqms.net/content/grundfos/www/en/${modifiedLinkBase}?wcmmode=disabled" class="previewSiteLocal" target="_blank">https://author-grundfos-prod-65.adobecqms.net/content/grundfos/www/en/${modifiedLinkBase}?wcmmode=disabled</a></p>`;
                            const originalLinkBase = linkBase;
                            let finalLink = null;
                            for (let key in linkMapping) {
                                if (linkMapping.hasOwnProperty(key) && originalLinkBase.includes(key)) {
                                    finalLink = originalLinkBase.replace(key, linkMapping[key]);
                                    break;
                                }
                            }
                            if (!finalLink) {
                                finalLink = `https://www.grundfos.com/${originalLinkBase}`;
                            }
                            linksHTML += `<p>Live Site Link: <a href="${finalLink}" target="_blank">${finalLink}</a></p>`;
                        } else {
                            linksHTML += `<p>Site Live: <a href="${localLinkSitesLocal}" class="liveSiteLocal" target="_blank">${localLinkSitesLocal}</a></p>`;
                            linksHTML += `<p>Editor: <a href="${localLinkEditorLocal}" class="editSiteLocal" target="_blank">${localLinkEditorLocal}</a></p>`;
                            linksHTML += `<p>Publish: <a href="${localpublishLinks}" class="pulishSiteLocal" target="_blank">${localpublishLinks}</a></p>`;
                            linksHTML += `<p>Preview: <a href="${localLinkDisabledLocal}" class="previewSiteLocal" target="_blank">${localLinkDisabledLocal}</a></p>`;
                            const localePrefix = selectedLocalLanguage.split("/")[0];
                            const localeSuffix = selectedLocalLanguage.split("/")[1];
                            const liveLink = `https://www.grundfos.com/${selectedLocalLanguage.split("/")[0]}/${baseUrl}`;
                            let newLink = `https://www.grundfos.com/${baseUrl}`;
                            if (["ch/fr", "be/fr", "ca/fr"].includes(selectedLocalLanguage)) {
                                newLink = `https://www.grundfos.com/${selectedLocalLanguage}/${baseUrl}`;
                            } else {
                                newLink = `https://www.grundfos.com/${localePrefix}/${baseUrl}`;
                            }
                            if (newLink.includes("/products")) {
                                let originalLink = newLink;
                                if (originalLink.includes("https://www.grundfos.com/")) {
                                    newLink = originalLink.replace("https://www.grundfos.com/", "https://product-selection.grundfos.com/").replace("/products", "");
                                }
                                if (originalLink.includes("https://www.grundfos.com/cn/")) {
                                    newLink = originalLink.replace("https://www.grundfos.com/cn/", "https://product-selection.grundfos.cn/").replace("/products", "");
                                }
                                newLink = newLink.replace("/www/", "/");
                                newLink = newLink.replace("/gb/", "/uk/");
                                linksHTML += `<p>Live Site Link: <a href="${newLink}" class="liveSiteLink" target="_blank">${newLink}</a><br></p>`;
                            } else if (newLink.includes("solutions/learn")) {
                                newLink = newLink.replace("solutions/learn", "learn");
                                linksHTML += `<p>Live Site Link: <a href="${newLink}" class="liveSiteLink" target="_blank">${newLink}</a><br></p>`;
                            } else {
                                let originalLink = newLink;
                                if (originalLink.includes("https://www.grundfos.com/cn/")) {
                                    newLink = originalLink.replace("https://www.grundfos.com/cn/", "https://www.grundfos.cn/");
                                }
                                newLink = newLink.replace("/www/", "/");
                                newLink = newLink.replace("/gb/", "/uk/");
                                linksHTML += `<p>Live Site Link: <a href="${newLink}" class="liveSiteLink" target="_blank">${newLink}</a><br></p>`;
                            }
                        }
                    });
                } else {
                    linksHTML += `<p><strong>No local languages selected.</strong></p>`;
                }
                return linksHTML;
            }
            function generateLinksForCondition1(masterLanguage, localLanguagesChecked, customInput, linksDiv) {
                const uniqueLinks = new Set();
                const uniqueTexts = new Set();
                let PartLinkExists = false;
                let MasterenGBExists = false;
                let MasterLocalExists = false;
                localLanguagesChecked.forEach((localLanguage) => {
                    const parts = localLanguage.split("/");
                    const liveSiteLanguage = parts[0];
                    let linksHTML = ``;
                    const editorLink = `https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/language-masters/${masterLanguage}/${customInput}`;
                    const Rollout = `https://author-grundfos-prod-65.adobecqms.net/mnt/overlay/wcm/msm/content/touch-ui/admin/rolloutdialog.html/content/grundfos/language-masters/${masterLanguage}/${customInput}`;
                    const localProperties = `https://author-grundfos-prod-65.adobecqms.net/mnt/overlay/wcm/core/content/sites/properties.html?item=/content/grundfos/${masterLanguage}/${customInput}`;
                    const sitesLink = `https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/language-masters/${masterLanguage}/${customInput}`;
                    const previewLink = `https://author-grundfos-prod-65.adobecqms.net/content/grundfos/language-masters/${masterLanguage}/${customInput}?wcmmode=disabled`;
                    const editorLinkMaster = `https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/language-masters/en-GB/${customInput}`;
                    const previewLinkMaster = `https://author-grundfos-prod-65.adobecqms.net/content/grundfos/language-masters/en-GB/${customInput}?wcmmode=disabled`;
                    const sitesLinkMaster = `https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/language-masters/en-GB/${customInput}`;
                    const RolloutMaster = `https://author-grundfos-prod-65.adobecqms.net/mnt/overlay/wcm/msm/content/touch-ui/admin/rolloutdialog.html/content/grundfos/language-masters/en-GB/${customInput}`;
                    const localPropertiesMaster = `https://author-grundfos-prod-65.adobecqms.net/mnt/overlay/wcm/core/content/sites/properties.html?item=/content/grundfos/en-GB/${customInput}`;
                    const liveLink = `https://www.grundfos.com/${liveSiteLanguage}/${customInput}`;

                    if (!PartLinkExists) {
                        linksHTML = `<p class="link-part"><strong>Part of the link:</strong> "${customInput}"</p>`;
                        PartLinkExists = true;
                    }
                    if (masterLanguage === "en-GB") {
                        if (!MasterenGBExists) {
                            linksHTML += `<p><strong>Master Language:</strong> (en-GB)</p>`;
                            MasterenGBExists = true;
                        }
                        if (!uniqueLinks.has(sitesLinkMaster)) {
                            linksHTML += `<p><strong>Site Live (en_GB)</strong>: <a href="${sitesLinkMaster}" class="siteliveEngbMaster" target="_blank">${sitesLinkMaster}</a></p>`;
                            uniqueLinks.add(sitesLinkMaster);
                        }
                        if (!uniqueLinks.has(editorLinkMaster)) {
                            linksHTML += `<p><strong>Editor (en_GB)</strong>: <a href="${editorLinkMaster}" class="editliveEngbMaster"  target="_blank">${editorLinkMaster}</a></p>`;
                            uniqueLinks.add(editorLinkMaster);
                        }
                        if (!uniqueLinks.has(RolloutMaster)) {
                            linksHTML += `<p><strong>Rollout (en_GB)</strong>: <a href="${RolloutMaster}" class="rolloutlocalMaster"  target="_blank">${RolloutMaster}</a></p>`;
                            uniqueLinks.add(RolloutMaster);
                        }
                        if (!uniqueLinks.has(localPropertiesMaster)) {
                            linksHTML += `<p><strong>Properties (en_GB)</strong>: <a href="${localPropertiesMaster}" class="propertieslocalMaster" target="_blank">${localPropertiesMaster}</a></p>`;
                            uniqueLinks.add(localPropertiesMaster);
                        }
                        if (!uniqueLinks.has(previewLinkMaster)) {
                            linksHTML += `<p><strong>Preview (en_GB)</strong>: <a href="${previewLinkMaster}" class="previewliveEngbMaster" target="_blank">${previewLinkMaster}</a><br></p>`;
                            uniqueLinks.add(previewLinkMaster);
                        }
                    } else {
                        if (!MasterenGBExists) {
                            linksHTML += `<p><strong>Master Language:</strong> (en-GB)</p>`;
                            MasterenGBExists = true;
                        }
                        if (!uniqueLinks.has(sitesLinkMaster)) {
                            linksHTML += `<p><strong>Site Live (en_GB)</strong>: <a href="${sitesLinkMaster}" class="siteliveEngbMaster"  target="_blank">${sitesLinkMaster}</a></p>`;
                            uniqueLinks.add(sitesLinkMaster);
                        }
                        if (!uniqueLinks.has(editorLinkMaster)) {
                            linksHTML += `<p><strong>Editor (en_GB)</strong>: <a href="${editorLinkMaster}" class="editliveEngbMaster" target="_blank">${editorLinkMaster}</a></p>`;
                            uniqueLinks.add(editorLinkMaster);
                        }
                        if (!uniqueLinks.has(previewLinkMaster)) {
                            linksHTML += `<p><strong>Preview (en_GB)</strong>: <a href="${previewLinkMaster}" class="previewliveEngbMaster"  target="_blank">${previewLinkMaster}</a><br></p>`;
                            uniqueLinks.add(previewLinkMaster);
                        }
                    }
                    if (masterLanguage !== "en-GB") {
                        if (!MasterLocalExists) {
                            linksHTML += `<p><strong>Master Language:</strong> (${masterLanguage})</p>`;
                            MasterLocalExists = true;
                        }
                        if (!uniqueLinks.has(sitesLink)) {
                            linksHTML += `<p><strong>Site Live (${masterLanguage})</strong>: <a href="${sitesLink}"  class="sitelivelocalMaster"  target="_blank">${sitesLink}</a></p>`;
                            uniqueLinks.add(sitesLink);
                        }
                        if (!uniqueLinks.has(editorLink)) {
                            linksHTML += `<p><strong>Editor (${masterLanguage})</strong>: <a href="${editorLink}" class="editlocalMaster" target="_blank">${editorLink}</a></p>`;
                            uniqueLinks.add(editorLink);
                        }
                        if (!uniqueLinks.has(Rollout)) {
                            linksHTML += `<p><strong>Rollout (${masterLanguage})</strong>: <a href="${Rollout}" class="rolloutlocalMaster"  target="_blank">${Rollout}</a></p>`;
                            uniqueLinks.add(Rollout);
                        }
                        if (!uniqueLinks.has(localProperties)) {
                            linksHTML += `<p><strong>Properties (${masterLanguage})</strong>: <a href="${localProperties}" class="propertieslocalMaster" target="_blank">${localProperties}</a></p>`;
                            uniqueLinks.add(localProperties);
                        }
                        if (!uniqueLinks.has(previewLink)) {
                            linksHTML += `<p><strong>Preview (${masterLanguage})</strong>: <a href="${previewLink}" class="previewlocalMaster" target="_blank">${previewLink}</a></p>`;
                            uniqueLinks.add(previewLink);
                        }
                    }
                    linksHTML += generateAdditionalLinks(masterLanguage, localLanguage, customInput, localLanguages, liveSiteLanguage, linksDiv);
                    linksDiv.innerHTML += linksHTML;
                    removeDuplicateLinks(linksDiv);
                });
            }
            let savedFragmentInputs = [];
            const fragmentInput = document.getElementById("fragmentInput");
            const savedFragmentsContainer = document.getElementById("savedFragments");
            const clearFragmentsButton = document.getElementById("clearFragments");
            const fragmentContainer = document.getElementById("fragmentContainer");
            clearFragmentsButton.addEventListener("click", () => {
                savedFragmentInputs = [];
                updateSavedFragmentsCheckboxes();
                fragmentContainer.innerHTML = "";
                saveFragmentsToLocalStorage();
            });

            let currentMasterLanguage = "";
            let currentLocalLanguages = [];
            let currentSelectedFragments = [];
            document.addEventListener("DOMContentLoaded", () => {
                document.getElementById("masterLanguage").addEventListener("change", handleMasterLanguageChange);
                document.getElementById("addFragment").addEventListener("click", () => {
                    const fragmentValue = fragmentInput.value.trim();
                    const normalizedNewFragment = extractFragmentPath(fragmentValue);
                    const normalizedSavedFragments = savedFragmentInputs.map(extractFragmentPath);

                    if (normalizedNewFragment && !normalizedSavedFragments.includes(normalizedNewFragment)) {
                        savedFragmentInputs.push(fragmentValue);
                        saveFragmentsToLocalStorage();
                        currentSelectedFragments = [];
                        const existingCheckboxes = document.querySelectorAll('#savedFragments input[type="checkbox"]');
                        existingCheckboxes.forEach((cb) => {
                            cb.checked = false;
                            const removeBtn = cb.parentElement.nextElementSibling;
                            if (removeBtn) removeBtn.style.display = "none";
                        });
                        fragmentInput.value = "";
                        fragmentContainer.innerHTML = "";
                        updateSavedFragmentsCheckboxes();
                        const newCheckbox = document.querySelector(`#savedFragments input[type="checkbox"][value="${fragmentValue}"]`);
                        if (newCheckbox) {
                            newCheckbox.checked = true;
                            const removeButton = newCheckbox.parentElement.nextElementSibling;
                            if (removeButton) {
                                removeButton.style.display = "inline-block";
                            }
                            currentSelectedFragments = [fragmentValue];
                        }
                        const localLanguagesChecked = Array.from(document.querySelectorAll('#localLanguages input[type="checkbox"]:checked')).map((cb) => cb.value);
                        if (localLanguagesChecked.length > 0) {
                            generateLinksForCondition3();
                        }
                    } else {
                        alert("Fragment already exists or is empty!");
                    }
                });
            });
            function saveFragmentsToLocalStorage() {
                localStorage.setItem("savedFragments", JSON.stringify(savedFragmentInputs));
            }
            function updateSavedFragmentsCheckboxes() {
                const savedFragmentContainer = document.getElementById("savedFragments");
                savedFragmentContainer.innerHTML = "";
                if (!Array.isArray(currentSelectedFragments)) {
                    currentSelectedFragments = [];
                }
                const currentChecked = currentSelectedFragments;

                savedFragmentInputs.forEach((fragment) => {
                    const fragmentsIndex = fragment.indexOf("/fragments");
                    let fragmentPath = fragmentsIndex !== -1 ? fragment.substring(fragmentsIndex) : "";
                    if (fragmentPath.endsWith(".html")) {
                        fragmentPath = fragmentPath.slice(0, -5);
                    }
                    if (fragmentPath.endsWith("/")) {
                        fragmentPath = fragmentPath.slice(0, -1);
                    }
                    const fragmentDiv = document.createElement("div");
                    fragmentDiv.style.display = "flex";
                    fragmentDiv.style.alignItems = "center";
                    fragmentDiv.style.marginBottom = "5px";
                    const label = document.createElement("label");
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.value = fragment;
                    const isChecked = currentChecked.includes(fragment);
                    checkbox.checked = isChecked;
                    const removeButton = document.createElement("button");
                    removeButton.textContent = "X";
                    removeButton.style.marginLeft = "10px";
                    removeButton.style.cursor = "pointer";
                    removeButton.style.padding = "5px";
                    removeButton.style.display = "none";

                    if (isChecked) {
                        removeButton.style.display = "inline-block";
                    }
                    checkbox.addEventListener("change", function (e) {
                        removeButton.style.display = e.target.checked ? "inline-block" : "none";
                        handleSavedFragmentChange();
                        saveSavedFragmentsState();
                    });

                    removeButton.addEventListener("click", function () {
                        removeFragment(fragment);
                    });
                    label.appendChild(checkbox);
                    label.appendChild(document.createTextNode(` ${fragmentPath}`));
                    fragmentDiv.appendChild(label);
                    fragmentDiv.appendChild(removeButton);
                    savedFragmentContainer.appendChild(fragmentDiv);
                });
                saveSavedFragmentsState();
                const allCheckboxes = document.querySelectorAll('#savedFragments input[type="checkbox"]');
                allCheckboxes.forEach((checkbox) => {
                    const removeButton = checkbox.parentElement.nextElementSibling;
                    if (removeButton) {
                        if (!checkbox.checked || !currentSelectedFragments.includes(checkbox.value)) {
                            removeButton.style.display = "none";
                            checkbox.checked = false;
                        } else {
                            removeButton.style.display = "inline-block";
                        }
                    }
                });
            }
            function extractFragmentPath(value) {
                const fragmentsIndex = value.indexOf("/fragments");
                if (fragmentsIndex !== -1) {
                    let fragment = value.substring(fragmentsIndex);
                    if (fragment.endsWith(".html")) fragment = fragment.slice(0, -5);
                    if (fragment.endsWith("/")) fragment = fragment.slice(0, -1);
                    return fragment.toLowerCase();
                }
                return "";
            }

            function toggleRemoveButton(checkbox, removeButton) {
                removeButton.style.display = checkbox.checked ? "inline-block" : "none";
            }
            function removeFragment(fragment) {
                const index = savedFragmentInputs.indexOf(fragment);
                if (index !== -1) {
                    savedFragmentInputs.splice(index, 1);
                }
                currentSelectedFragments = currentSelectedFragments.filter((f) => f !== fragment);
                updateSavedFragmentsCheckboxes();
                saveSavedFragmentsState();
                if (currentSelectedFragments.length === 0) {
                    fragmentContainer.innerHTML = "";
                } else {
                    handleSavedFragmentChange();
                }
                saveFragmentsToLocalStorage();
            }
            function selectNewlyAddedCheckbox(fragmentValue) {
                const checkbox = document.querySelector(`#savedFragments input[type="checkbox"][value="${fragmentValue}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            }
            function handleSavedFragmentChange() {
                const savedFragmentCheckboxes = document.querySelectorAll('#savedFragments input[type="checkbox"]:checked');
                currentSelectedFragments = Array.from(savedFragmentCheckboxes).map((checkbox) => checkbox.value);
                document.querySelectorAll('#savedFragments input[type="checkbox"]').forEach((checkbox) => {
                    const removeButton = checkbox.parentElement.nextElementSibling;
                    if (removeButton) {
                        removeButton.style.display = checkbox.checked ? "inline-block" : "none";
                    }
                });
                fragmentContainer.innerHTML = "";
                if (currentSelectedFragments.length > 0) {
                    generateLinksForCondition3();
                }
                saveSavedFragmentsState();
            }
            function handleMasterLanguageChange() {
                const masterLanguage = document.getElementById("masterLanguage").value;
                if (currentMasterLanguage !== masterLanguage) {
                    currentMasterLanguage = masterLanguage;
                    const searchContainer = document.getElementById("searchContainer");
                    const button = document.getElementById("toggleSearchButton");
                    searchContainer.style.display = "none";
                    button.textContent = "Show Search Input";
                    const localLanguageCheckboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                    localLanguageCheckboxes.forEach((checkbox) => {
                        checkbox.checked = false;
                    });
                    const savedFragmentCheckboxes = document.querySelectorAll('#savedFragments input[type="checkbox"]');
                    savedFragmentCheckboxes.forEach((checkbox, index) => {
                        checkbox.checked = index === 0;
                        const removeButton = checkbox.parentElement.nextElementSibling;
                        if (removeButton) {
                            removeButton.style.display = index === 0 ? "inline-block" : "none";
                        }
                    });
                    currentLocalLanguages = [];
                    currentSelectedFragments = savedFragmentCheckboxes.length > 0 ? [savedFragmentCheckboxes[0].value] : [];
                    updateLocalLanguages();
                    setTimeout(() => {
                        const firstCheckbox = document.querySelector('#localLanguages input[type="checkbox"]');
                        if (firstCheckbox) {
                            firstCheckbox.checked = true;
                            firstCheckbox.dispatchEvent(new Event("change"));
                        }
                        generateLinksForCondition3();
                    }, 100);
                }
            }
            document.addEventListener("DOMContentLoaded", () => {
                loadSelectionsFromLocalStorage();
                const savedFragments = localStorage.getItem("savedFragments");
                if (savedFragments) {
                    savedFragmentInputs = JSON.parse(savedFragments);

                    const checkedFragments = JSON.parse(localStorage.getItem("checkedSavedFragments") || "[]");
                    currentSelectedFragments = checkedFragments;
                }
                updateSavedFragmentsCheckboxes();
                const savedFragmentCheckboxes = document.querySelectorAll('#savedFragments input[type="checkbox"]');
                savedFragmentCheckboxes.forEach((checkbox) => {
                    checkbox.addEventListener("change", handleSavedFragmentChange);
                });
                if (currentSelectedFragments.length > 0) {
                    generateLinksForCondition3();
                }

                document.getElementById("masterLanguage").addEventListener("change", saveSelectionsToLocalStorage);
                document.querySelectorAll('#localLanguages input[type="checkbox"]').forEach((cb) => {
                    cb.addEventListener("change", saveSelectionsToLocalStorage);
                });
                document.querySelectorAll('input[name="condition"]').forEach((cb) => {
                    cb.addEventListener("change", saveSelectionsToLocalStorage);
                });
            });
            function generateLinksForCondition3() {
                fragmentContainer.innerHTML = "";
                const checkboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]:checked');
                const localLanguagesChecked = Array.from(checkboxes).map((checkbox) => checkbox.value);
                const masterLanguage = document.getElementById("masterLanguage").value;
                currentLocalLanguages = localLanguagesChecked;
                if (!masterLanguage) {
                    console.log("No master language selected");
                    return;
                }

                if (currentSelectedFragments.length === 0) {
                    console.log("No fragments selected");
                    return;
                }

                if (localLanguagesChecked.length === 0) {
                    console.log("No local languages selected");
                    return;
                }
                currentSelectedFragments.forEach((fragment) => {
                    const fragmentsIndex = fragment.indexOf("/fragments");
                    let fragmentPath = fragmentsIndex !== -1 ? fragment.substring(fragmentsIndex) : "";
                    if (fragmentPath.endsWith(".html")) {
                        fragmentPath = fragmentPath.slice(0, -5);
                    }
                    if (fragmentPath.endsWith("/")) {
                        fragmentPath = fragmentPath.slice(0, -1);
                    }
                    console.log("Fragment fragmentPath:", fragmentPath);

                    const masterLinkEditor = `https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/language-masters/${masterLanguage}${fragmentPath}`;
                    const masterLinkSites = `https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/language-masters/${masterLanguage}${fragmentPath}`;
                    const masterLinkPreview = `https://author-grundfos-prod-65.adobecqms.net/content/grundfos/language-masters/${masterLanguage}${fragmentPath}?wcmmode=disabled`;
                    const Rollout = `https://author-grundfos-prod-65.adobecqms.net/mnt/overlay/wcm/msm/content/touch-ui/admin/rolloutdialog.html/content/grundfos/language-masters/${masterLanguage}${fragmentPath}`;
                    let fragmentHtml = `<p class="link-part"><strong>Selected Fragment:</strong> "${fragmentPath}"</p>`;
                    if (masterLanguage !== "en-GB") {
                        fragmentHtml += `<p><strong>Master Language:</strong> en-GB</p>`;
                        fragmentHtml += `Site Live (en-GB): <a href="https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/language-masters/en-GB${fragmentPath}" class="fragment-sitelive-enGB" target="_blank">https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/language-masters/en-GB${fragmentPath}</a><br>`;
                        fragmentHtml += `Editor (en-GB): <a href="https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/language-masters/en-GB${fragmentPath}" class="fragment-edit-enGB" target="_blank">https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/language-masters/en-GB${fragmentPath}</a><br>`;

                        fragmentHtml += `Preview (en-GB): <a href="https://author-grundfos-prod-65.adobecqms.net/content/grundfos/language-masters/en-GB${fragmentPath}?wcmmode=disabled" class="fragment-preview-enGB" target="_blank">https://author-grundfos-prod-65.adobecqms.net/content/grundfos/language-masters/en-GB${fragmentPath}?wcmmode=disabled</a><br>`;
                    }
                    fragmentHtml += `<p><strong>Master Language:</strong> ${masterLanguage}</p>`;
                    fragmentHtml += `Site Live: <a href="${masterLinkSites}" target="_blank"  class="fragment-sitelive-localMaster">${masterLinkSites}</a><br>`;
                    fragmentHtml += `Editor: <a href="${masterLinkEditor}" target="_blank" class="fragment-edit-localMaster">${masterLinkEditor}</a><br>`;
                    fragmentHtml += `Rollout: <a href="${Rollout}" target="_blank" class="fragment-rollout-localMaster">${Rollout}</a><br>`;
                    fragmentHtml += `Preview: <a href="${masterLinkPreview}" target="_blank" class="fragment-preview-localMaster">${masterLinkPreview}</a><br>`;
                    const localLanguagesList = localLanguages[masterLanguage] || [];
                    if (localLanguagesChecked.includes(masterLanguage)) {
                        const remainingLanguages = localLanguagesList.filter((lang) => lang !== masterLanguage);
                        if (remainingLanguages.length > 0) {
                            fragmentHtml += `<p><strong>Master Language Selected (${masterLanguage}): ${remainingLanguages.join(", ")}</strong></p>`;
                        } else {
                            fragmentHtml += `<p><strong>Master Language Selected (${masterLanguage}): No additional locales available to display.</strong></p>`;
                        }
                        remainingLanguages.forEach((language) => {
                            fragmentHtml += generateLocalLanguageLinks(language, fragmentPath);
                        });
                    } else if (localLanguagesChecked.length > 0) {
                        fragmentHtml += `<p><strong>Selected Local Languages:</strong> ${localLanguagesChecked.join(", ")}</p>`;
                        localLanguagesChecked.forEach((selectedLocalLanguage) => {
                            fragmentHtml += generateLocalLanguageLinks(selectedLocalLanguage, fragmentPath);
                        });
                    } else {
                        fragmentHtml += `<p><strong>No local languages selected.</strong></p>`;
                    }
                    fragmentContainer.innerHTML += fragmentHtml;
                });
            }
            function generateLocalLanguageLinks(language, fragmentPath) {
                const localLinkEditorLocal = `https://author-grundfos-prod-65.adobecqms.net/editor.html/content/grundfos/${language}${fragmentPath}`;
                const localLinkSitesLocal = `https://author-grundfos-prod-65.adobecqms.net/sites.html/content/grundfos/${language}${fragmentPath}`;
                const localLinkDisabledLocal = `https://author-grundfos-prod-65.adobecqms.net/content/grundfos/${language}${fragmentPath}?wcmmode=disabled`;
                const localpublishLinks = `https://author-grundfos-prod-65.adobecqms.net/mnt/override/libs/wcm/core/content/common/managepublicationwizard.html?item=/content/grundfos/${language}${fragmentPath}`;

                return (
                    `<p><strong>Local Language (${language}):</strong></p>` +
                    `Site Live: <a href="${localLinkSitesLocal}"  class="fragment-sitelive-livesitelocal" target="_blank">${localLinkSitesLocal}</a><br>` +
                    `Editor: <a href="${localLinkEditorLocal}"  class="fragment-edit-livesitelocal" target="_blank">${localLinkEditorLocal}</a><br>` +
                    `Publish: <a href="${localpublishLinks}"  class="fragment-publish-livesitelocal" target="_blank">${localpublishLinks}</a><br>` +
                    `Preview: <a href="${localLinkDisabledLocal}"  class="fragment-preview-livesitelocal" target="_blank">${localLinkDisabledLocal}</a><br>`
                );
            }
            document.addEventListener("DOMContentLoaded", function () {
                const select = document.getElementById("masterLanguage");
                const options = Array.from(select.options);
                options.sort((a, b) => {
                    if (a.value === "") return -1;
                    return a.text.localeCompare(b.text);
                });
                select.innerHTML = "";
                options.forEach((option) => {
                    select.appendChild(option);
                });
            });
            document.addEventListener("DOMContentLoaded", function () {
                const customInput = document.getElementById("customInput");
                const masterLanguage = document.getElementById("masterLanguage");
                masterLanguage.disabled = true;
                customInput.addEventListener("input", function () {
                    masterLanguage.disabled = customInput.value.trim() === "";
                });
            });

            function convertText() {
                const input = document.getElementById("inputText").value.trim();
                if (input.length === 0) {
                    return;
                }
                const output = input.charAt(0).toUpperCase() + input.slice(1).toLowerCase();
                document.getElementById("inputText").value = output;
            }
            document.addEventListener("DOMContentLoaded", () => {
                let previousLink = null;
                observeContainers();
                loadLinkStates();
                updateResetButtons();
                document.addEventListener("click", (event) => {
                    const target = event.target;
                    if (target && target.tagName === "A") {
                        const parentContainer = target.closest("#links, #fragmentContainer");
                        if (parentContainer) {
                            const currentLang = getCurrentLang();
                            if (previousLink) {
                                previousLink.classList.remove("active");
                                previousLink.classList.add("previous");
                                saveLinkState(currentLang, previousLink.href, "previous");
                            }
                            target.classList.add("active");
                            target.classList.remove("previous");
                            saveLinkState(currentLang, target.href, "active");
                            previousLink = target;
                            updateResetButtons();
                        }
                    }
                });
                document.getElementById("resetLinks").addEventListener("click", () => {
                    resetLinks("#links");
                    alert("The link status in #links has been reset!");
                });
                document.getElementById("resetFragmentLinks").addEventListener("click", () => {
                    resetLinks("#fragmentContainer");
                    alert("The link state in #fragmentContainer has been reset!");
                });
                function saveLinkState(lang, href, state) {
                    const storageKey = `linkStates_${lang}`;
                    const linkStates = JSON.parse(localStorage.getItem(storageKey) || "{}");
                    linkStates[href] = state;
                    localStorage.setItem(storageKey, JSON.stringify(linkStates));
                }
                function loadLinkStates() {
                    const currentLang = getCurrentLang();
                    const storageKey = `linkStates_${currentLang}`;
                    const linkStates = JSON.parse(localStorage.getItem(storageKey) || "{}");
                    ["#links", "#fragmentContainer"].forEach((containerId) => {
                        const container = document.querySelector(containerId);
                        if (!container) return;
                        for (const [href, state] of Object.entries(linkStates)) {
                            const link = Array.from(container.querySelectorAll("a")).find((link) => link.href === href);
                            if (link) {
                                link.classList.add(state);
                                if (state === "active") previousLink = link;
                            }
                        }
                    });
                    updateResetButtons();
                }
                function resetLinks(containerId) {
                    document.querySelectorAll(`${containerId} a`).forEach((link) => {
                        link.classList.remove("active", "previous");
                    });
                    const linksLang = getCurrentLang();
                    const storageKey = `linkStates_${linksLang}`;
                    localStorage.removeItem(storageKey);
                    updateResetButtons();
                }
                function getCurrentLang() {
                    const pathParts = window.location.pathname.split("/").filter((part) => part);
                    return pathParts.length >= 2 ? `${pathParts[0]}/${pathParts[1]}` : "default";
                }
                function observeContainers() {
                    const observer = new MutationObserver(() => {
                        loadLinkStates();
                    });
                    const config = { childList: true, subtree: true };
                    ["#links", "#fragmentContainer"].forEach((containerId) => {
                        const container = document.querySelector(containerId);
                        if (container) observer.observe(container, config);
                    });
                }
                function updateResetButtons() {
                    const hasActiveLinks = document.querySelector("#links a.active, #links a.previous");
                    const hasActiveFragmentLinks = document.querySelector("#fragmentContainer a.active, #fragmentContainer a.previous");
                    document.getElementById("resetLinks").style.display = hasActiveLinks ? "block" : "none";
                    document.getElementById("resetFragmentLinks").style.display = hasActiveFragmentLinks ? "block" : "none";
                }
            });
            document.getElementById("customInput").addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    generateLinks();
                }
            });
            document.getElementById("searchInput").addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    applySearchInput();
                }
            });
            document.getElementById("customInput").addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    document.getElementById("generateAndSaveBtn").click();
                }
            });
            document.addEventListener("keydown", function (event) {
                if (event.target.id === "masterCodeInput" && event.key === "Enter") {
                    event.preventDefault();
                    generateMasterCheckboxes();
                }
            });
            document.getElementById("fragmentInput").addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    const fragmentValue = fragmentInput.value.trim();
                    if (fragmentValue && !savedFragmentInputs.includes(fragmentValue)) {
                        savedFragmentInputs.push(fragmentValue);
                        currentSelectedFragments = [fragmentValue];
                        updateSavedFragmentsCheckboxes();
                        selectNewlyAddedCheckbox(fragmentValue);
                        fragmentInput.value = "";
                        fragmentContainer.innerHTML = "";
                        generateLinksForCondition3();
                    } else {
                    }
                }
            });
            function saveSelectionsToLocalStorage() {
                const masterLanguage = document.getElementById("masterLanguage").value;
                const localLanguageCheckboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]:checked');
                const taskCheckboxes = document.querySelectorAll('input[name="condition"]:checked');
                const selectedLocalLanguages = Array.from(localLanguageCheckboxes).map((cb) => cb.value);
                const selectedTasks = Array.from(taskCheckboxes).map((cb) => cb.value);
                localStorage.setItem("selectedMasterLanguage", masterLanguage);
                localStorage.setItem("selectedLocalLanguages", JSON.stringify(selectedLocalLanguages));
                localStorage.setItem("selectedTaskTypes", JSON.stringify(selectedTasks));
            }
            function loadSelectionsFromLocalStorage() {
                const masterSelect = document.getElementById("masterLanguage");
                if (masterSelect) {
                    const masterLanguage = localStorage.getItem("selectedMasterLanguage");
                    if (masterLanguage) {
                        masterSelect.value = masterLanguage;
                        masterSelect.dispatchEvent(new Event("change"));
                    }
                }
                const customInput = document.getElementById("customInput");
                if (customInput) {
                    const savedCustomInput = localStorage.getItem("customInputValue") || "";
                    customInput.value = savedCustomInput;
                }
                const fragmentInput = document.getElementById("fragmentInput");
                if (fragmentInput) {
                    const savedFragmentInput = localStorage.getItem("fragmentInputValue") || "";
                    fragmentInput.value = savedFragmentInput;
                }
                const localLanguageCheckboxes = document.querySelectorAll('#localLanguages input[type="checkbox"]');
                const selectedLocalLanguages = JSON.parse(localStorage.getItem("selectedLocalLanguages") || "[]");
                localLanguageCheckboxes.forEach((cb) => {
                    cb.checked = selectedLocalLanguages.includes(cb.value);
                });
                const taskCheckboxes = document.querySelectorAll('input[name="condition"]');
                const selectedTasks = JSON.parse(localStorage.getItem("selectedTaskTypes") || "[]");
                taskCheckboxes.forEach((cb) => {
                    cb.checked = selectedTasks.includes(cb.value);
                });
            }
            function saveSavedFragmentsState() {
                const savedFragmentCheckboxes = document.querySelectorAll('#savedFragments input[type="checkbox"]');
                const checkedFragments = [];
                savedFragmentCheckboxes.forEach((checkbox) => {
                    if (checkbox.checked) checkedFragments.push(checkbox.value);
                });
                localStorage.setItem("checkedSavedFragments", JSON.stringify(checkedFragments));
                currentSelectedFragments = checkedFragments;
                localStorage.setItem("savedFragments", JSON.stringify(savedFragmentInputs));
            }
        </script>
    </body>
</html>
